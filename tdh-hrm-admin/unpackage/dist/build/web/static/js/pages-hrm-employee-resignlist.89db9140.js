(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-hrm-employee-resignlist"],{"054e":function(e,t,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("39d8")),r=i(a("3471")),o=i(a("2634")),l=i(a("2fdc"));a("bf0f"),a("2797"),a("5c47"),a("0506"),a("c223"),a("7a76"),a("c9b5"),a("e966"),a("aa9c"),a("5ef2"),a("8f71"),a("4626"),a("5ac7"),a("3efd"),a("fd3c"),a("af8f"),a("f7a5"),a("d4b5");a("3ae2");var s,d=uni.vk,c={},p={data:function(){var e=this;return{departments:[],fileList:[],loading:!1,data:{},table1:{action:"admin/hrm/employees/sys/getList",rightBtns:[{mode:"detail_auto",title:"详细",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-employee-view")}},{mode:"update",title:"编辑",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-employee-edit")}},{mode:"delete",title:"删除",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-employee-delete")}}],columns:[{key:"employee_id",title:"员工工号",type:"text",fixed:!0,width:100},{key:"center_id",title:"中心代码",type:"text",fixed:!0,width:100},{key:"centers.center_name",title:"六大中心",type:"text",fixed:!0,width:100},{key:"points.point_name",title:"分点名称",type:"text",fixed:!0,width:200},{key:"employee_name",title:"员工姓名",type:"text",fixed:!0,width:100},{key:"card",title:"身份证号码",type:"text",width:200},{key:"bank_card",title:"银行卡号",type:"text",width:200},{key:"banks.bank_name",title:"银行名称",type:"text",width:100},{key:"locations.location_name",title:"开户地",type:"text",width:200},{key:"gender",title:"性别",type:"number",width:50,formatter:function(e,t,a,i){return 1==t.gender?"男":"女"}},{key:"nations.name",title:"民族",type:"text",width:50},{key:"departments.department_name",title:"所属部门",type:"text",width:200},{key:"managers.employee_name",title:"上级主管",type:"text",width:100},{key:"companys.company_name",title:"所属公司",type:"text",width:100},{key:"positions.position_name",title:"职位名称",type:"text",width:100},{key:"hire_date",title:"入职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:100},{key:"resign_date",title:"离职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:100},{key:"mobile",title:"手机号码",type:"text",width:150},{key:"educationals.educational_name",title:"学历",type:"text",width:50},{key:"insurances.insurance_name",title:"保险",type:"text",width:200},{key:"stay",title:"住宿",type:"number",width:50,formatter:function(e,t,a,i){return 1==t.gender?"是":"否"}},{key:"contracts.contract_name",title:"合同是否签定",type:"text",width:150},{key:"contract_date",title:"合同到期日",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:100},{key:"contract_desc",title:"合同签订情况",type:"text",width:200},{key:"registration",title:"档案是否登记\t",type:"number",width:150,formatter:function(e,t,a,i){return 1==t.gender?"是":"否"}},{key:"birth_month",title:"月份",type:"number",width:100},{key:"birth_date",title:"出生日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:100},{key:"expiration_date",title:"身份证有效期限",type:"text",width:150},{key:"age",title:"年龄",type:"number",width:50},{key:"card_location",title:"户口所在地",type:"text",width:200},{key:"emergency_contact",title:"紧急联系人",type:"text",width:100},{key:"emergency_mobile",title:"紧急联系人电话",type:"text",width:150},{key:"internals.employee_name",title:"内部介绍人",type:"text",width:100},{key:"marital_status",title:"婚姻情况",type:"number",width:100,formatter:function(e,t,a,i){return 1==e?"已婚":"未婚"}},{key:"no_crime",title:"无犯罪证明",type:"number",width:100,formatter:function(e,t,a,i){return 1==e?"有":"无"}},{key:"resigntypes.type_name",title:"离职类型",type:"text",width:100},{key:"handovers.employee_name",title:"交接人",type:"text",width:100},{key:"status",title:"用户状态",type:"number",width:100,formatter:function(e,t,a,i){return 1==e?"在职":"离职"}},{key:"resign_desc",title:"离职原因",type:"text",show:["detail"],width:200},{key:"comment",title:"备注",type:"text",show:["detail"],width:200},{key:"avatar",title:"头像",type:"avatar",width:50},{key:"expected_salary",title:"意向工资",type:"text",show:["row"],showRule:function(t){return e.$hasPermission("hrm-employee-edit")},width:100},{key:"file_attachments",title:"证明文件",type:"html",width:200,show:["detail"],formatter:function(e,t,a,i){if(e&&e.length>0){var n="",r=t._id||t.employee_id||"row-".concat(i);return e.forEach((function(t,a){if(t){var i=t.split("/").pop()||"证明文件",o=i.split(".").pop().toLowerCase(),l=/(jpg|jpeg|png|gif|bmp|webp)$/i.test(o),s="".concat(r,"-file-").concat(a);n+=l?'<a href="javascript:void(0);" \n\t\t\t\t\t                               id="'.concat(s,'"\n\t\t\t\t\t                               class="file-preview-link"\n\t\t\t\t\t                               data-url="').concat(t,'"\n\t\t\t\t\t                               data-row-id="').concat(r,'"\n\t\t\t\t\t                               data-file-index="').concat(a,'"\n\t\t\t\t\t                               data-is-image="true"\n\t\t\t\t\t                               style="color: #409EFF; text-decoration: underline; margin-right: 5px;">\n\t\t\t\t\t                             ').concat(i,"\n\t\t\t\t\t                           </a>"):'<a href="'.concat(t,'" \n\t\t\t\t\t                               download="').concat(i,'" \n\t\t\t\t\t                               target="_blank" \n\t\t\t\t\t                               style="color: #67C23A; text-decoration: underline; margin-right: 5px;">\n\t\t\t\t\t                             ').concat(i,"\n\t\t\t\t\t                           </a>"),a<e.length-1&&(n+="，")}})),n+='<span style="margin-left: 5px; color: #909399; font-size: 12px;">('.concat(e.length,"个文件)</span>"),n}return'<span style="color: #909399;">无</span>'}},{key:"update_date",title:"更新时间",type:"time",width:200,show:["detail"]},{key:"users.nickname",title:"更新人",type:"text",width:200,show:["detail"]}],multipleSelection:[],selectItem:""},queryForm1:{formData:{status:2},columns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"="},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"card",title:"身份证号码",type:"text",width:190,mode:"="},{key:"gender",title:"性别",type:"select",width:150,data:[{value:1,label:"男"},{value:2,label:"女"}],mode:"="},{key:"status",title:"用户状态",hidden:!0,type:"select",width:150,data:[{value:1,label:"在职"},{value:2,label:"离职"}],mode:"="},{key:"company_id",title:"所属公司",type:"text",width:150,mode:"="},{key:"department_id",title:"所属部门",type:"text",width:150,mode:"="},{key:"center_id",title:"六大中心",type:"remote-select",placeholder:"请选择中心名称",width:200,action:"admin/hrm/center/sys/getList",props:{list:"rows",value:"center_id",label:"center_name"},showAll:!0,actionData:{pageSize:1e3}}]},form1:{data:{employee_type:1,hire_date:new Date,status:1},props:{action:"",columns:[{key:"employee_id",title:"员工工号",type:"text",width:200},{key:"employee_name",title:"员工姓名",type:"text",width:200},{key:"center_id",title:"六大中心",type:"remote-select",placeholder:"请选择中心名称",width:200,action:"admin/hrm/center/sys/getList",props:{list:"rows",value:"center_id",label:"center_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"point_id",title:"分点名称",type:"remote-select",placeholder:"请选择分点名称",width:200,action:"admin/hrm/point/sys/getList",props:{list:"rows",value:"point_id",label:"point_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"card",title:"身份证号码",type:"text",width:200,watch:function(){var t=(0,l.default)((0,o.default)().mark((function t(a){var i,n,r;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=d.myfn.test1(a.value),n="",0!=i.code){t.next=11;break}return t.next=5,d.myfn.getResignEmployees(a.value);case 5:r=t.sent,d.pubfn.isNotNull(r)&&(r.forEach((function(e){n+="姓名：".concat(e.employee_name,"(").concat(e.employee_id,")\n入职日期：").concat(e.hire_date,"\n离职日期：").concat(e.resign_date,"\n离职原因：").concat(e.resign_desc)})),d.alert(n,"该员工为再次入职，信息如下","确定")),e.$set(e.form1.data,"gender",i.data.sex),e.$set(e.form1.data,"age",i.data.age),e.$set(e.form1.data,"birth_month",i.data.month),e.$set(e.form1.data,"birth_date",i.data.birthday);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"bank_card",title:"银行卡号",type:"text",width:200},{key:"bank_id",title:"银行名称",type:"remote-select",placeholder:"请选择银行名称",width:200,disabled:!0,action:"admin/hrm/bank/sys/getList",props:{list:"rows",value:"bank_id",label:"bank_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"location_id",title:"开户地",type:"remote-select",placeholder:"请选择开户地",width:200,action:"admin/hrm/banklocation/sys/getList",props:{list:"rows",value:"location_id",label:"location_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"birth_month",title:"月份",type:"number",disabled:!0,width:200},{key:"birth_date",title:"出生日期",type:"date",disabled:!0,dateType:"date",valueFormat:"yyyy-MM-dd",width:200},{key:"age",title:"年龄",type:"number",disabled:!0,width:200},{key:"gender",title:"员工性别",type:"radio",disabled:!0,width:200,data:[{value:1,label:"男"},{value:2,label:"女"}]},{key:"nation_id",title:"民族",type:"remote-select",placeholder:"请选择民族",width:200,action:"admin/hrm/nation/sys/getList",props:{list:"rows",value:"_id",label:"name"},showAll:!0,actionData:{pageSize:1e3}},{key:"position_id",title:"职位名称",type:"remote-select",placeholder:"请选择职位名称",action:"admin/hrm/position/sys/getList",width:200,props:{list:"rows",value:"position_id",label:"position_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"company_id",title:"所属公司",type:"tree-select",width:200,action:"admin/hrm/company/sys/getList",props:{list:"rows",value:"company_id",label:"company_name",children:"children"},watch:function(t){var a=t.value,i=(t.formData,t.column,t.index,t.option,t.$set,d.pubfn.getListItem(e.form1.props.columns,"key","department_id"));i.actionData.company_id=a,e.$set(e.form1.data,i.key,"")}},{key:"department_id",title:"所属部门",type:"tree-select",action:"admin/hrm/department/pub/getList",props:{list:"rows",value:"department_id",label:"department_name",children:"children"},actionData:{company_id:""},width:200,watch:function(t){t.value,t.formData,t.column,t.index;var a=t.option,i=(t.$set,d.pubfn.getListItem(e.form1.props.columns,"key","manager_id"));e.$set(e.form1.data,i.key,a.department_manager_id)}},{key:"manager_id",title:"上级主管",type:"table-select",placeholder:"选择上级主管",width:200,action:"admin/hrm/employees/sys/getList",multiple:!1,columns:[{key:"employee_id",title:"员工工号",type:"text",idKey:!0},{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0}],queryColumns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"%%"},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"status",title:"状态",type:"number",mode:"=",show:["none"]}],formData:function(){return{status:1}}},{key:"hire_date",title:"入职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:200},{key:"resign_date",title:"离职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:200},{key:"mobile",title:"手机号码",type:"text",width:200},{key:"educational_id",title:"学历",type:"remote-select",placeholder:"请选择学历",width:200,action:"admin/hrm/educational/sys/getList",props:{list:"rows",value:"educational_id",label:"educational_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"insurance_id",title:"保险",type:"remote-select",placeholder:"请选择保险",width:200,action:"admin/hrm/insurance/sys/getList",props:{list:"rows",value:"insurance_id",label:"insurance_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"stay",title:"住宿",type:"radio",width:200,data:[{value:1,label:"是"},{value:2,label:"否"}]},{key:"contract_id",title:"合同是否签定",type:"remote-select",placeholder:"请选择合同是否签定",action:"admin/hrm/contract/sys/getList",width:200,props:{list:"rows",value:"contract_id",label:"contract_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"contract_date",title:"合同到期日",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:200},{key:"contract_desc",title:"合同签订情况",type:"text",width:200},{key:"registration",title:"档案是否登记",type:"radio",width:200,data:[{value:1,label:"是"},{value:2,label:"否"}]},{key:"expiration_date",title:"身份证有效期限",type:"text",width:200},{key:"emergency_contact",title:"紧急联系人",type:"text",width:200},{key:"emergency_mobile",title:"紧急联系人电话",type:"text",width:200},{key:"card_location",title:"户口所在地",type:"textarea",maxlength:"99",showWordLimit:!0,width:200,autosize:{minRows:3,maxRows:10}},{key:"internal_id",title:"内部介绍人",type:"table-select",placeholder:"选择内部介绍人",width:200,action:"admin/hrm/employees/sys/getList",multiple:!1,columns:[{key:"employee_id",title:"员工工号",type:"text",idKey:!0},{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0}],queryColumns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"%%"},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"status",title:"状态",type:"number",mode:"=",show:["none"]}],formData:function(){return{status:1}}},{key:"marital_status",title:"婚姻状况",type:"radio",width:200,data:[{value:1,label:"已婚"},{value:2,label:"未婚"}]},{key:"no_crime",title:"无犯罪证明",type:"radio",width:200,data:[{value:1,label:"有"},{value:2,label:"无"}]},{key:"status",title:"用户状态",type:"radio",width:200,defaultValue:1,data:[{value:1,label:"在职"},{value:2,label:"离职"}]},{key:"type_id",title:"离职类型",type:"remote-select",width:200,placeholder:"请选择离职类型",action:"admin/hrm/resigntype/sys/getList",props:{list:"rows",value:"type_id",label:"type_name"},showAll:!0,actionData:{pageSize:1e3}},{key:"expected_salary",title:"意向工资",precision:0,type:"number",width:200},{key:"handover_person_id",title:"交接人",type:"table-select",placeholder:"选择交接人",width:200,action:"admin/hrm/employees/sys/getList",multiple:!1,columns:[{key:"employee_id",title:"员工工号",type:"text",idKey:!0},{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0}],queryColumns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"%%"},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"status",title:"状态",type:"number",mode:"=",show:["none"]}],formData:function(){return{status:1}}},{key:"avatar",title:"头像地址",type:"avatar",width:200},{key:"file_attachments",title:"证明文件",type:"file",oneLine:!0,limit:9,accept:".jpeg,.jpg,.png,.pdf",fileSize:2,sizeUnit:"mb",tips:"只能上传pdf/jpg/png文件，且不超过2MB",cloudPathRemoveChinese:!1},{key:"resign_desc",title:"离职原因",type:"textarea",maxlength:"99",showWordLimit:!0,width:630,autosize:{minRows:4,maxRows:10}},{key:"comment",title:"备注",type:"textarea",maxlength:"99",showWordLimit:!0,width:630,autosize:{minRows:4,maxRows:10}}],rules:{center_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],point_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],bank_id:[{required:!1,message:"该项不能为空",trigger:["blur","change"]}],bank_card:[{required:!1,message:"该项不能为空",trigger:["blur","change"]},{validator:function(){var t=(0,l.default)((0,o.default)().mark((function t(a,i,n){var r;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return d.pubfn.isNull(i)&&n(),t.next=3,d.request({method:"get",url:"https://ccdcapi.alipay.com/validateAndCacheCardInfo.json",data:{cardNo:i,cardBinCheck:!0},contentType:"json",dataType:"json"});case 3:r=t.sent,d.pubfn.isNull(r.bank)?n(new Error("银行卡号不正确")):(e.$set(e.form1.data,"bank_id",r.bank),n());case 5:case"end":return t.stop()}}),t)})));return function(e,a,i){return t.apply(this,arguments)}}(),trigger:"blur"}],location_id:[{required:!1,message:"该项不能为空",trigger:["blur","change"]}],nation_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],educational_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],insurance_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],stay:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],contract_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],contract_date:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],contract_desc:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],registration:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],expiration_date:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],card_location:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],marital_status:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],no_crime:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],employee_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],employee_name:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],mobile:[{required:!0,message:"该项不能为空",trigger:["blur","change"]},{validator:d.pubfn.validator("mobile"),message:"手机号格式错误",trigger:"blur"}],emergency_mobile:[{validator:d.pubfn.validator("mobile"),message:"手机号格式错误",trigger:"blur"}],card:[{required:!0,message:"该项不能为空",trigger:["blur","change"]},{validator:d.pubfn.validator("card"),message:"身份证格式错误",trigger:["blur"]}],birth_date:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],birth_month:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],age:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],gender:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],department_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],company_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],hire_date:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],position_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],type_id:[{validator:function(t,a,i){if(2==e.form1.data.status){if(!a)return i(new Error("离职类型不能为空！"));i()}else e.$set(e.form1.data,"resign_date",""),e.$set(e.form1.data,"type_id",""),i()},trigger:["blur","change"]}],resign_date:[{validator:function(t,a,i){if(2==e.form1.data.status){if(!a)return i(new Error("离职日期不能为空！"));if(a<e.form1.data.hire_date)return i(new Error("离职日期不能小于入职日期！"));i()}else e.$set(e.form1.data,"resign_date",""),e.$set(e.form1.data,"type_id",""),i()},trigger:["blur","change"]}]},formType:"",title:"",show:!1}},formDatas:{}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d=this.vk,this.options=e,this.init(e)},onReady:function(){},onShow:function(){},onHide:function(){},beforeDestroy:function(){this.handleFileClick&&document.removeEventListener("click",this.handleFileClick)},methods:(s={init:function(e){var t=this;c["form1"]=d.pubfn.copyObject(this.form1),this.$nextTick((function(){t.bindFileClickEvents()}))},bindFileClickEvents:function(){var e=this;document.removeEventListener("click",this.handleFileClick),this.handleFileClick=function(t){var a=t.target;if(a.classList.contains("file-preview-link")){t.preventDefault();var i=a.getAttribute("data-url"),n=a.getAttribute("data-row-id"),r=(parseInt(a.getAttribute("data-file-index"),10),document.querySelectorAll('[data-row-id="'.concat(n,'"].file-preview-link'))),o=[];if(r.forEach((function(e){var t=e.getAttribute("data-url"),a=t.split(".").pop().toLowerCase();/(jpg|jpeg|png|gif|bmp|webp)$/i.test(a)&&o.push(t)})),o.length>0){var l=o.indexOf(i);e.previewImage(i,o,l)}}},document.addEventListener("click",this.handleFileClick)},previewImage:function(e,t,a){var i=t.filter((function(e){if(!e)return!1;var t=e.split(".").pop().toLowerCase();return/(jpg|jpeg|png|gif|bmp|webp)$/i.test(t)}));0!==i.length?((void 0===a||a<0||a>=i.length)&&(a=0),!i.includes(e)&&e&&(i.unshift(e),a=0),uni.previewImage({current:a,urls:i,indicator:"number",loop:!0,success:function(){console.log("图片预览成功")},fail:function(t){console.error("图片预览失败:",t),e&&uni.showModal({title:"提示",content:"图片预览失败，是否下载图片？",success:function(t){t.confirm&&uni.downloadFile({url:e,success:function(e){200===e.statusCode&&uni.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){uni.showToast({title:"图片已保存到相册",icon:"success"})},fail:function(e){console.error("保存图片失败:",e),uni.showToast({title:"保存图片失败",icon:"none"})}})},fail:function(e){console.error("下载图片失败:",e),uni.showToast({title:"下载图片失败",icon:"none"})}})}})}})):uni.showToast({title:"没有可预览的图片",icon:"none"})},toTreeData:function(e){return e.filter((function(e){return d.pubfn.isNull(e.parent_department_id)})).map((function(e){return function e(t){return{value:t.department_id,label:t.department_name,manager:t.department_manager_id,children:t.children&&t.children.length>0?t.children.map((function(t){return e(t)})):[]}}(e)}))},toCompany:function(e){var t=this;return(0,l.default)((0,o.default)().mark((function a(){var i,n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.departments=[],a.next=3,d.callFunction({url:"admin/hrm/department/pub/getList",title:"请求中...",data:{company_id:e}});case 3:i=a.sent,n=t.toTreeData(i.rows),t.departments=n,t.$refs.table1.queryParam.formData.department_id="",t.$set(t.form1,"department_id",""),t.search();case 9:case"end":return a.stop()}}),a)})))()},toDepartment:function(e){this.$set(this.queryForm1.formData,"department_id",e),this.search()}},(0,n.default)(s,"init",(function(e){var t=this;c["form1"]=d.pubfn.copyObject(this.form1),this.$nextTick((function(){t.bindFileClickEvents()}))})),(0,n.default)(s,"pageTo",(function(e){d.navigateTo(e)})),(0,n.default)(s,"resetForm",(function(){this.$set(this.form1,"department_id",""),d.pubfn.resetForm(c,this)})),(0,n.default)(s,"search",(function(){this.$refs.table1.search()})),(0,n.default)(s,"refresh",(function(){this.$refs.table1.refresh()})),(0,n.default)(s,"getCurrentRow",(function(){return this.$refs.table1.getCurrentRow()})),(0,n.default)(s,"currentChange",(function(e){this.table1.selectItem=e})),(0,n.default)(s,"selectionChange",(function(e){this.table1.multipleSelection=e})),(0,n.default)(s,"addBtn",(function(){this.resetForm(),this.form1.props.action="admin/hrm/employees/sys/add",this.form1.props.formType="add",this.form1.props.title="添加",this.form1.props.show=!0})),(0,n.default)(s,"updateBtn",(function(e){var t=e.item,a=d.pubfn.getListItem(this.form1.props.columns,"key","department_id");a.actionData.company_id=t.company_id,this.form1.props.action="admin/hrm/employees/sys/update",this.form1.props.formType="update",this.form1.props.title="编辑",this.form1.props.show=!0,this.form1.data=t})),(0,n.default)(s,"deleteBtn",(function(e){var t=e.item,a=e.deleteFn;a({action:"admin/hrm/employees/sys/delete",data:{_id:t._id}})})),(0,n.default)(s,"batchBtn",(function(e){switch(e){case 1:d.toast("批量操作按钮1");break;case 2:d.toast("批量操作按钮2");break;default:break}})),(0,n.default)(s,"handleChange",(function(e){var t=this,a=0,i="";try{this.$iexcel.importExcel(e.raw,{card:{title:"身份证号码",type:"text"},resign_date:{title:"离职日期",type:"date"},resign_desc:{title:"离职原因",type:"text"},type_id:{title:"离职类型",type:"text"},status:{title:"用户状态",type:"number"}},function(){var e=(0,l.default)((0,o.default)().mark((function e(n){var l,s,c,p,m,u,y,h,f,g;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n&&0!==n.length){e.next=2;break}return e.abrupt("return",d.alert("Excel中没有数据！"));case 2:if(l=n.map((function(e){return e.card})).filter((function(e){return e})),0!==l.length){e.next=5;break}return e.abrupt("return",d.alert("Excel中没有有效的身份证号码！"));case 5:return d.toast("检查人员基本资料中..."),e.next=8,d.callFunction({url:"admin/hrm/employees/pub/getCheckCards",title:"检查人员资料...",data:{cards:l}});case 8:if(s=e.sent,!(s.cardeds&&s.cardeds.length>0)){e.next=13;break}return c=s.cardeds.slice(0,10).join(", "),p=s.cardeds.length>10?"人员基本资料不能为空(".concat(s.cardeds.length,"条): ").concat(c,"...等"):"人员基本资料不能为空(".concat(s.cardeds.length,"条): ").concat(c),e.abrupt("return",d.alert(p,"检测Excel导入数据","确定"));case 13:return d.toast("获取员工信息中..."),e.next=16,d.myfn.batchGetEmployeeInfo(l);case 16:if(m=e.sent,m){e.next=19;break}return e.abrupt("return",d.alert("获取员工信息失败！"));case 19:u=(0,r.default)(n),e.prev=20,u.s();case 22:if((y=u.n()).done){e.next=43;break}if(h=y.value,!d.pubfn.isNull(h.card)){e.next=27;break}return d.alert("身份证号不能为空"),e.abrupt("break",43);case 27:return f=m.get(h.card),h.employee_id=f.employee_id,"主动辞职"===h.type_id?h.type_id="03":h.type_id="退休"===h.type_id?"01":"02",h.status="在职"===h.status?1:2,e.next=33,d.callFunction({url:"admin/hrm/employees/pub/updateResign",title:"请求中...",data:h});case 33:if(g=e.sent,0!=g.code){e.next=38;break}a++,e.next=41;break;case 38:return a=0,i=JSON.stringify(h),e.abrupt("break",43);case 41:e.next=22;break;case 43:e.next=48;break;case 45:e.prev=45,e.t0=e["catch"](20),u.e(e.t0);case 48:return e.prev=48,u.f(),e.finish(48);case 51:t.fileList=[],0==a?d.alert("错误数据:".concat(i),"导入Excel失败","确定",(function(){})):d.alert("导入数据:".concat(a,"条"),"导入Excel成功","确定",(function(){t.refresh()}));case 53:case"end":return e.stop()}}),e,null,[[20,45,48,51]])})));return function(t){return e.apply(this,arguments)}}())}catch(n){console.log(n)}})),(0,n.default)(s,"exportExcelModel",(function(){this.$refs.table1.exportExcel({fileName:(new Date).getFullYear()+"离职员工列表模版",title:"正在导出数据...",columns:[{key:"card",title:"身份证号码",type:"text"},{key:"resign_date",title:"离职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd"},{key:"resign_desc",title:"离职原因",type:"text"},{key:"type_id",title:"离职类型",type:"text",formatter:function(e,t,a,i){return"03"===e?"主动辞职":"01"==e?"退休":"被辞退"}},{key:"status",title:"用户状态",type:"number",formatter:function(e,t,a,i){return 1==e?"在职":"离职"}}],pageIndex:1,pageSize:1})})),(0,n.default)(s,"exportExcelAll",(function(){this.$refs.table1.exportExcel({fileName:(new Date).getFullYear()+"离职人员信息",title:"正在导出数据...",columns:[{key:"employee_id",title:"员工工号",type:"text"},{key:"center_id",title:"中心代码",type:"text"},{key:"centers.center_name",title:"六大中心",type:"text"},{key:"points.point_name",title:"分点名称",type:"text"},{key:"employee_name",title:"员工姓名",type:"text"},{key:"card",title:"身份证号码",type:"text"},{key:"bank_card",title:"银行卡号",type:"text"},{key:"banks.bank_name",title:"银行名称",type:"text"},{key:"locations.location_name",title:"开户地",type:"text"},{key:"gender",title:"性别",type:"number",formatter:function(e,t,a,i){return 1==t.gender?"男":"女"}},{key:"nations.name",title:"民族",type:"text"},{key:"departments.department_name",title:"所属部门",type:"text"},{key:"managers.employee_name",title:"上级主管",type:"text"},{key:"companys.company_name",title:"所属公司",type:"text"},{key:"positions.position_name",title:"职位名称",type:"text"},{key:"hire_date",title:"入职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd"},{key:"resign_date",title:"离职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd"},{key:"mobile",title:"手机号码",type:"text"},{key:"educationals.educational_name",title:"学历",type:"text"},{key:"insurances.insurance_name",title:"保险",type:"text"},{key:"stay",title:"住宿",type:"number",formatter:function(e,t,a,i){return 1==t.stay?"是":"否"}},{key:"contracts.contract_name",title:"合同是否签定",type:"text"},{key:"contract_date",title:"合同到期日",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd"},{key:"contract_desc",title:"合同签订情况",type:"text"},{key:"registration",title:"档案是否登记\t",type:"number",formatter:function(e,t,a,i){return 1==t.registration?"是":"否"}},{key:"birth_month",title:"月份",type:"number",width:200},{key:"birth_date",title:"出生日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd"},{key:"expiration_date",title:"身份证有效期限",type:"text"},{key:"age",title:"年龄",type:"number"},{key:"card_location",title:"户口所在地",type:"text"},{key:"emergency_contact",title:"紧急联系人",type:"text"},{key:"emergency_mobile",title:"紧急联系人电话",type:"text"},{key:"internals.employee_name",title:"内部介绍人",type:"text"},{key:"marital_status",title:"婚姻情况",type:"number",formatter:function(e,t,a,i){return 1==t.marital_status?"已婚":"未婚"}},{key:"no_crime",title:"无犯罪证明",type:"number",formatter:function(e,t,a,i){return 1==t.no_crime?"有":"无"}},{key:"resign_desc",title:"离职原因",type:"text"},{key:"comment",title:"备注",type:"text"},{key:"resigntypes.type_name",title:"离职类型",type:"text"},{key:"handovers.employee_name",title:"交接人",type:"text"},{key:"status",title:"用户状态",type:"number",formatter:function(e,t,a,i){return 1==e?"在职":"离职"}}],pageIndex:1,pageSize:-1})})),s),watch:{},computed:{}};t.default=p},3709:function(e,t,a){"use strict";a.r(t);var i=a("c3bb"),n=a("a047");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("9b88");var o=a("828b"),l=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"0038a896",null,!1,i["a"],void 0);t["default"]=l.exports},7970:function(e,t,a){var i=a("a6ab");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("967d").default;n("5b5df804",i,!0,{sourceMap:!1,shadowMode:!1})},"9b88":function(e,t,a){"use strict";var i=a("7970"),n=a.n(i);n.a},a047:function(e,t,a){"use strict";a.r(t);var i=a("054e"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a},a6ab:function(e,t,a){var i=a("c86c");t=i(!1),t.push([e.i,"",""]),e.exports=t},c3bb:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"page-body"},[a("vk-data-table-query",{ref:"queryForm1",attrs:{columns:e.queryForm1.columns},on:{search:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)},reset:function(t){arguments[0]=t=e.$handleEvent(t),e.resetForm.apply(void 0,arguments)}},scopedSlots:e._u([{key:"company_id",fn:function(t){var i=t.form;return[a("vk-data-input-tree-select",{attrs:{action:"admin/hrm/company/sys/getList",props:{list:"rows",value:"company_id",label:"company_name",children:"children"},placeholder:"请选择"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.toCompany.apply(void 0,arguments)}},model:{value:i.company_id,callback:function(t){e.$set(i,"company_id",t)},expression:"form.company_id"}})]}},{key:"department_id",fn:function(t){t.form;return[a("vk-data-input-tree-select",{attrs:{localdata:e.departments,placeholder:"请选择"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.toDepartment.apply(void 0,arguments)}},model:{value:e.form1.department_id,callback:function(t){e.$set(e.form1,"department_id",t)},expression:"form1.department_id"}})]}}]),model:{value:e.queryForm1.formData,callback:function(t){e.$set(e.queryForm1,"formData",t)},expression:"queryForm1.formData"}}),a("v-uni-view",[a("el-row",[e.$hasRole("admin")||e.$hasPermission("hrm-employee-add")?a("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addBtn.apply(void 0,arguments)}}},[e._v("添加")]):e._e(),e.$hasRole("admin")||e.$hasPermission("hrm-employee-export")?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.exportExcelAll.apply(void 0,arguments)}}},[e._v(" 导出全部 ")]):e._e(),e.$hasRole("admin")||e.$hasPermission("hrm-employee-add")?a("el-upload",{staticStyle:{display:"inline-block","margin-left":"20rpx","margin-right":"20rpx"},attrs:{accept:".xlsx, .xls","auto-upload":!1,limit:1,"show-file-list":!1,"file-list":e.fileList,"on-change":e.handleChange,action:""}},[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-upload2"}},[e._v("导入excel")])],1):e._e(),e.$hasRole("admin")||e.$hasPermission("hrm-employee-add")?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-tickets"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.exportExcelModel.apply(void 0,arguments)}}},[e._v(" 下载模版 ")]):e._e()],1)],1),a("vk-data-table",{ref:"table1",attrs:{action:e.table1.action,columns:e.table1.columns,"query-form-param":e.queryForm1,"right-btns":e.table1.rightBtns,selection:!0,"row-no":!1,pagination:!0},on:{update:function(t){arguments[0]=t=e.$handleEvent(t),e.updateBtn.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deleteBtn.apply(void 0,arguments)},"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.currentChange.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}}),a("vk-data-dialog",{attrs:{title:e.form1.props.title,width:"900px",mode:"form","close-on-click-modal":!1},model:{value:e.form1.props.show,callback:function(t){e.$set(e.form1.props,"show",t)},expression:"form1.props.show"}},[a("vk-data-form",{ref:"form1",attrs:{rules:e.form1.props.rules,action:e.form1.props.action,"form-type":e.form1.props.formType,columns:e.form1.props.columns,"label-width":"130px",inline:!0,columnsNumber:2,border:!0},on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.form1.props.show=!1,e.refresh()}},model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1)],1)},n=[]}}]);