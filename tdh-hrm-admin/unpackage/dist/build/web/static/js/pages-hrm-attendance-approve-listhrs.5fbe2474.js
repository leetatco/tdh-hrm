(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-hrm-attendance-approve-listhrs"],{2201:function(e,t,n){"use strict";n.r(t);var a=n("ed52"),r=n("3a52");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("7455");var o=n("828b"),s=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,"092b8ae2",null,!1,a["a"],void 0);t["default"]=s.exports},3362:function(e,t,n){var a=n("c86c");t=a(!1),t.push([e.i,"",""]),e.exports=t},"3a52":function(e,t,n){"use strict";n.r(t);var a=n("7c39"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},7455:function(e,t,n){"use strict";var a=n("eca7"),r=n.n(a);r.a},"7c39":function(e,t,n){"use strict";n("6a54");var a=n("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("9b1b")),i=a(n("3471")),o=a(n("2634")),s=a(n("2fdc"));n("c223"),n("5c47"),n("af8f"),n("bf0f"),n("f3f7"),n("18f7"),n("de6c"),n("08eb"),n("aa9c"),n("c1a3"),n("f7a5"),n("2797"),n("7a76"),n("c9b5");var l=uni.vk,c={},u=new Date(l.pubfn.getOffsetTime(new Date,{mode:"before"})).getFullYear(),d=new Date(l.pubfn.getOffsetTime(new Date,{mode:"before"})).getMonth(),m=d>9?d:"0".concat(d),y=l.myfn.normalizeMonth("".concat(u,"-").concat(m)),p={data:function(){var e=this;return{nowym:"",loading:!1,data:{},table1:{action:"admin/hrm/attendance/sys/approve/getList",rightBtns:[{mode:"detail_auto",title:"详细",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-attendance-view")}},{mode:"update",title:"编辑",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-attendance-edit")}},{mode:"delete",title:"删除",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-attendance-delete")}}],dataPreprocess:function(e){return e},columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM",fixed:!0,width:100},{key:"employee_id",title:"员工工号",type:"text",fixed:!0,width:100},{key:"employees.employee_name",title:"员工姓名",type:"text",fixed:!0,width:100},{key:"employees.card",title:"身份证号码",type:"text",fixed:!0,width:170},{key:"employees.departments.department_name",title:"部门",type:"text",fixed:!0,width:200,formatter:function(e,t,n,a){return l.pubfn.isNotNull(t.resign_month)&&y.split("-")[1]!=t.resign_month?t.resign_month+e:e}},{key:"employees.positions.position_name",title:"职位",type:"text",width:100},{key:"employees.hire_date",title:"入职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",format:"yyyy-MM-dd",width:100},{key:"resign_month",title:"离职日期",type:"number",width:110,formatter:function(e,t,n,a){return e?e+"月离职工资":""}},{key:"work_days",title:"全勤天数",type:"number",width:100},{key:"real_days",title:"实际天数",type:"number",width:100},{key:"overtime_hours",title:"加班小时",type:"number",width:100},{key:"overtime_cost",title:"加班费",type:"number",width:100},{key:"earlytime_hours",title:"迟/早退(分)",type:"number",width:100},{key:"earlytime_cost",title:"迟到费",type:"number",width:100},{key:"missed_count",title:"未打卡(次)",type:"number",width:100},{key:"missed_cost",title:"未打卡费",type:"number",width:100},{key:"share_cost",title:"水电费用",type:"number",width:100},{key:"clothes_cost",title:"工衣费用",type:"number",width:100},{key:"reward_cost",title:"奖励",type:"number",width:100},{key:"punish_cost",title:"惩罚",type:"number",width:100},{key:"agency_fee",title:"介绍费",type:"number",width:100},{key:"other_cost",title:"其它费用",type:"number",width:100},{key:"marriage_leave",title:"婚假",type:"number",width:100},{key:"maternity_leave",title:"产假",type:"number",width:100},{key:"paternity_leave",title:"陪产假",type:"number",width:100},{key:"sick_leave",title:"病假",type:"number",width:100},{key:"emergency_leave",title:"丧假",type:"number",width:100},{key:"work_injury",title:"工伤",type:"number",width:100},{key:"allowance",title:"补助",type:"number",width:100},{key:"attendance_correction",title:"补考勤",type:"number",width:100},{key:"enable_hr",title:"考勤审核",type:"switch",activeValue:!0,inactiveValue:!1,width:100,watch:function(t){var n=t.value,a=t.row;t.change;l.callFunction({url:"admin/hrm/attendance/sys/approve/update",title:n?"通过中...":"未通过中...",data:{_id:a._id,attendance_ym_key:a.attendance_ym_key,employee_id:a.employee_id,enable_hr:n},success:function(t){e.refresh()}})}},{key:"comment",title:"备注",type:"text",show:["detail"],width:300},{key:"update_date",title:"更新时间",type:"time",width:200,show:["detail"]},{key:"users.nickname",title:"更新人",type:"text",width:200,show:["detail"]}],multipleSelection:[],selectItem:""},queryForm1:{formData:{attendance_ym:y,enable_hr:!1},columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM",width:200},{key:"enable_hr",title:"考勤审核",type:"select",width:200,hidden:!0,data:[{value:!0,label:"已通过"},{value:!1,label:"未通过"}],mode:"="},{key:"employee_id",title:"",type:"table-select",placeholder:"选择员工",action:"admin/hrm/employees/sys/getList",multiple:!1,columns:[{key:"employee_id",title:"员工工号",type:"text",idKey:!0},{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0},{key:"card",title:"身份证号码",type:"text",nameKey:!0}],queryColumns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"%%"},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"card",title:"身份证号码",type:"text",width:150,mode:"%%"}]}]},form1:{data:{enable_hr:!1,enable_fd:!1},props:{action:"",columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM",width:200},{key:"employee_id",title:"",type:"table-select",placeholder:"选择员工",action:"admin/hrm/employees/sys/getList",multiple:!1,columns:[{key:"employee_id",title:"员工工号",type:"text",idKey:!0},{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0},{key:"card",title:"身份证号码",type:"text",nameKey:!0}],queryColumns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"%%"},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"card",title:"身份证号码",type:"text",width:150,mode:"%%"}]},{key:"resign_month",title:"离职日期",type:"number",disabled:!0,width:200},{key:"work_days",title:"全勤天数",type:"number",width:200},{key:"real_days",title:"实际天数",type:"number",width:200},{key:"overtime_hours",title:"加班小时",type:"number",precision:1,width:200},{key:"overtime_cost",title:"加班费",type:"number",disabled:!0,precision:0,width:200},{key:"earlytime_hours",title:"迟/早退(分)",type:"number",precision:0,width:200},{key:"earlytime_cost",title:"迟到费",disabled:!0,type:"number",precision:0,width:200},{key:"missed_count",title:"未打卡(次)",type:"number",precision:0,width:200},{key:"missed_cost",title:"未打卡费",type:"number",disabled:!0,precision:0,width:200},{key:"share_cost",title:"水电费用",type:"number",disabled:!0,precision:0,width:200},{key:"clothes_cost",title:"工衣费用",type:"number",disabled:!0,precision:0,width:200},{key:"reward_cost",title:"奖励",type:"number",disabled:!0,precision:0,width:200},{key:"punish_cost",title:"惩罚",type:"number",disabled:!0,precision:0,width:200},{key:"agency_fee",title:"介绍费",type:"number",disabled:!0,precision:0,width:100},{key:"other_cost",title:"其它费用",type:"number",disabled:!0,precision:0,width:200},{key:"marriage_leave",title:"婚假",type:"number",disabled:!0,precision:0,width:100},{key:"maternity_leave",title:"产假",type:"number",disabled:!0,precision:0,width:100},{key:"paternity_leave",title:"陪产假",type:"number",disabled:!0,precision:0,width:100},{key:"sick_leave",title:"病假",type:"number",disabled:!0,precision:0,width:100},{key:"emergency_leave",title:"丧假",type:"number",disabled:!0,precision:0,width:100},{key:"work_injury",title:"工伤",type:"number",disabled:!0,precision:0,width:100},{key:"allowance",title:"补助",type:"number",disabled:!0,precision:0,width:100},{key:"attendance_correction",title:"补考勤",type:"number",disabled:!0,precision:0,width:100},{key:"enable_hr",title:"考勤审核",type:"switch",width:200},{key:"comment",title:"备注",type:"textarea",maxlength:"99",showWordLimit:!0,width:200,autosize:{minRows:2,maxRows:10}}],rules:{attendance_ym:[{required:!0,message:"该项不能为空",trigger:["change"]}],employee_id:[{required:!0,message:"该项不能为空",trigger:["change"]}],work_days:[{required:!0,message:"该项不能为空",trigger:["change"]}],real_days:[{required:!0,message:"该项不能为空",trigger:["change"]}],overtime_hours:[{validator:function(){var t=(0,s.default)((0,o.default)().mark((function t(n,a,r){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a>0&&e.computCost();case 1:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),trigger:["change"]}],earlytime_hours:[{validator:function(){var t=(0,s.default)((0,o.default)().mark((function t(n,a,r){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a>0&&e.computCost();case 1:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),trigger:["change"]}],missed_count:[{validator:function(){var t=(0,s.default)((0,o.default)().mark((function t(n,a,r){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a>0&&e.computCost();case 1:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),trigger:["change"]}]},formType:"",title:"",show:!1}},formDatas:{}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l=this.vk,this.options=e,this.init(e)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{exportExcelAll:function(){this.$refs.table1.exportExcel({fileName:y+"员工考勤信息",title:"正在导出数据...",columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM"},{key:"employee_id",title:"员工工号",type:"text"},{key:"employees.employee_name",title:"员工姓名",type:"text"},{key:"employees.card",title:"身份证号码",type:"text"},{key:"employees.departments.department_name",title:"部门",type:"text",formatter:function(e,t,n,a){return l.pubfn.isNotNull(t.resign_month)&&y.split("-")[1]!=t.resign_month?t.resign_month+e:e}},{key:"employees.positions.position_name",title:"职位",type:"text"},{key:"employees.hire_date",title:"入职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",format:"yyyy-MM-dd"},{key:"resign_month",title:"离职日期",type:"number",formatter:function(e,t,n,a){return e?e+"月离职工资":""}},{key:"work_days",title:"全勤天数",type:"number"},{key:"real_days",title:"实际天数",type:"number"},{key:"overtime_hours",title:"加班小时",type:"number"},{key:"overtime_cost",title:"加班费",type:"number"},{key:"earlytime_hours",title:"迟/早退(分)",type:"number"},{key:"earlytime_cost",title:"迟到费",type:"number"},{key:"missed_count",title:"未打卡(次)",type:"number"},{key:"missed_cost",title:"未打卡费",type:"number"},{key:"share_cost",title:"水电费用",type:"number"},{key:"clothes_cost",title:"工衣费用",type:"number"},{key:"reward_cost",title:"奖励",type:"number"},{key:"punish_cost",title:"惩罚",type:"number"},{key:"agency_fee",title:"介绍费",type:"number"},{key:"other_cost",title:"其它费用",type:"number"},{key:"marriage_leave",title:"婚假",type:"number"},{key:"maternity_leave",title:"产假",type:"number"},{key:"paternity_leave",title:"陪产假",type:"number"},{key:"sick_leave",title:"病假",type:"number"},{key:"emergency_leave",title:"丧假",type:"number"},{key:"work_injury",title:"工伤",type:"number"},{key:"allowance",title:"补助",type:"number"},{key:"attendance_correction",title:"补考勤",type:"number"},{key:"enable_hr",title:"考勤审核",type:"text",formatter:function(e,t,n,a){return e?"通过":"未通过"}},{key:"comment",title:"备注",type:"text"}],pageIndex:1,pageSize:-1})},init:function(e){c["form1"]=l.pubfn.copyObject(this.form1)},pageTo:function(e){l.navigateTo(e)},resetForm:function(){l.pubfn.resetForm(c,this)},search:function(){this.$refs.table1.search()},refresh:function(){this.$refs.table1.refresh()},getCurrentRow:function(){return this.$refs.table1.getCurrentRow()},currentChange:function(e){this.table1.selectItem=e},selectionChange:function(e){this.table1.multipleSelection=e},computCost:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n,a,r,i,s,c,u,d,m,y,p;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l.callFunction({url:"admin/hrm/salary/sys/lateclock/getList",title:"请求中...",data:{}});case 2:return n=t.sent,t.next=5,l.callFunction({url:"admin/hrm/salary/sys/overtime/getList",title:"请求中...",data:{employee_id:"common"}});case 5:if(a=t.sent,0!=n.total){t.next=8;break}return t.abrupt("return",l.alert("请设定迟/早退打卡规则！"));case 8:if(0!=a.total){t.next=10;break}return t.abrupt("return",l.alert("请设通用加班规则！"));case 10:if(r=e.form1.data.employee_id||0,i=e.form1.data.overtime_hours||0,s=e.form1.data.earlytime_hours||0,c=e.form1.data.missed_count||0,0!=r){t.next=16;break}return t.abrupt("return",l.alert("请选择员工！"));case 16:if(0===i){t.next=21;break}return t.next=19,l.callFunction({url:"admin/hrm/salary/sys/overtime/getList",title:"请求中...",data:{employee_id:r}});case 19:u=t.sent,u.total>0?(d=i*u.rows[0].overtime_cost,e.$set(e.form1.data,"overtime_cost",d)):(m=i*(a.rows[0].overtime_cost||20),e.$set(e.form1.data,"overtime_cost",m));case 21:y=(s-n.rows[0].late_min)*n.rows[0].late_price,y>0?e.$set(e.form1.data,"earlytime_cost",y):e.$set(e.form1.data,"earlytime_cost",0),p=(c-n.rows[0].clock_min)*n.rows[0].clock_price,p>0?e.$set(e.form1.data,"missed_cost",p):e.$set(e.form1.data,"missed_cost",0);case 25:case"end":return t.stop()}}),t)})))()},autoBtn:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:l.confirm("确定将删除".concat(y,"月全部数据，重新生成考勤表数据！"),"提示","确定","取消",function(){var t=(0,s.default)((0,o.default)().mark((function t(n){var a,r,s,c,d,m,p,h,f,_,v,w,b,k;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.confirm){t.next=40;break}return t.prev=1,t.next=4,l.callFunction({url:"admin/hrm/attendance/sys/all/getListAll",title:"请求中...",data:{attendance_ym:y}});case 4:if(a=t.sent,0!=a.total){t.next=7;break}return t.abrupt("return",l.alert("没有".concat(y,"月考勤明细！")));case 7:return t.next=9,l.callFunction({url:"admin/hrm/attendance/sys/all/deleteAproAll",title:"请求中...",data:{attendance_ym:y}});case 9:if(r=t.sent,0==r.code){t.next=12;break}return t.abrupt("return",l.alert("".concat(y,"月考勤明细删除失败！")));case 12:s=[],c=new Set,d=(0,i.default)(a.rows);try{for(d.s();!(m=d.n()).done;)p=m.value,s.push(p.employee_id),h=void 0,l.pubfn.isNotNull(p.resign_month)&&y.split("-")[1]!=p.resign_month?(f=p.resign_month>9?p.resign_month:"0".concat(p.resign_month),h="".concat(u,"-").concat(f)):h=p.attendance_ym,p.attendance_ym_key=h,c.add(h)}catch(o){d.e(o)}finally{d.f()}return l.toast("开始获取费用数据..."),t.next=19,e.batchGetAllCosts(s,Array.from(c));case 19:return _=t.sent,l.toast("获取计算规则..."),t.next=23,e.getComputeRulesWithSpecial(s);case 23:if(v=t.sent,v){t.next=26;break}return t.abrupt("return");case 26:return l.toast("开始处理数据..."),t.next=29,e.processRowDatas(a.rows,_,v);case 29:return w=t.sent,t.next=32,l.callFunction({url:"admin/hrm/attendance/sys/all/addAproAll",title:"请求中...",data:{items:w}});case 32:b=t.sent,0===b.code?(k="新增考勤表完成！成功: ".concat(b.id.length,"条"),l.alert(k,"新增成功","确定",(function(){e.refresh()}))):l.alert("新增失败!","系统错误","确定"),t.next=40;break;case 36:t.prev=36,t.t0=t["catch"](1),console.error("处理过程中发生错误:",t.t0),l.alert("处理过程中发生错误: ".concat(t.t0.message),"系统错误","确定");case 40:case"end":return t.stop()}}),t,null,[[1,36]])})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},batchGetAllCosts:function(e,t){var n=this;return(0,s.default)((0,o.default)().mark((function a(){var i,s,c,u,d,m,y;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=new Map,e&&0!==e.length&&t&&0!==t.length){a.next=3;break}return a.abrupt("return",i);case 3:s=200,c=Math.ceil(e.length/s),u=0;case 6:if(!(u<e.length)){a.next=26;break}return d=e.slice(u,u+s),m=Math.floor(u/s)+1,l.toast("获取费用数据... (".concat(m,"/").concat(c,")")),a.prev=10,a.next=13,l.callFunction({url:"admin/hrm/attendance/sys/all/getCostAll",title:"获取费用数据中...",data:{employee_id:d,attendance_ym_key:t}});case 13:y=a.sent,0===y.code&&y.data?(y.data.we&&y.data.we.length>0&&y.data.we.forEach((function(e){var t="".concat(e.employee_id,"_").concat(e.attendance_ym),n=i.get(t)||{};i.set(t,(0,r.default)((0,r.default)({},n),{},{share_cost:(n.share_cost||0)+(e.share_cost||0)}))})),y.data.clothes&&y.data.clothes.length>0&&y.data.clothes.forEach((function(e){var t="".concat(e.employee_id,"_").concat(e.attendance_ym),n=i.get(t)||{};i.set(t,(0,r.default)((0,r.default)({},n),{},{clothes_cost:e.clothes_cost||0}))})),y.data.cost&&y.data.cost.length>0&&y.data.cost.forEach((function(e){var t="".concat(e.employee_id,"_").concat(e.attendance_ym),n=i.get(t)||{};i.set(t,(0,r.default)((0,r.default)({},n),{},{reward_cost:e.reward_cost||0,punish_cost:e.punish_cost||0,agency_fee:e.agency_fee||0,other_cost:e.other_cost||0}))}))):console.warn("第".concat(m,"批费用数据获取失败:"),y.msg),a.next=20;break;case 17:a.prev=17,a.t0=a["catch"](10),console.error("第".concat(m,"批费用数据获取异常:"),a.t0);case 20:if(!(u+s<e.length)){a.next=23;break}return a.next=23,n.delay(200);case 23:u+=s,a.next=6;break;case 26:return a.abrupt("return",i);case 27:case"end":return a.stop()}}),a,null,[[10,17]])})))()},getComputeRulesWithSpecial:function(e){var t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r,i;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,l.callFunction({url:"admin/hrm/salary/sys/lateclock/getList",title:"获取规则中...",data:{}});case 3:return a=n.sent,n.next=6,l.callFunction({url:"admin/hrm/salary/sys/overtime/getList",title:"获取规则中...",data:{employee_id:"common"}});case 6:if(r=n.sent,0!=a.total){n.next=10;break}return l.alert("请设定迟/早退打卡规则！"),n.abrupt("return",null);case 10:if(0!=r.total){n.next=13;break}return l.alert("请设通用加班规则！"),n.abrupt("return",null);case 13:return l.toast("获取特殊人员加班规则..."),n.next=16,t.batchGetSpecialOvertimeRules(e);case 16:return i=n.sent,n.abrupt("return",{ll_data:a,com_data:r,specialOvertimeMap:i});case 20:return n.prev=20,n.t0=n["catch"](0),console.error("获取计算规则失败:",n.t0),l.alert("获取计算规则失败: ".concat(n.t0.message)),n.abrupt("return",null);case 25:case"end":return n.stop()}}),n,null,[[0,20]])})))()},batchGetSpecialOvertimeRules:function(e){return(0,s.default)((0,o.default)().mark((function t(){var n,a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=new Map,t.prev=1,t.next=4,l.callFunction({url:"admin/hrm/salary/sys/overtime/getList",title:"获取特殊加班规则中...",data:{pageIndex:1,pageSize:-1,whereJson:{employee_id:{$ne:"common",$in:e}}}});case 4:a=t.sent,0===a.code&&a.rows&&a.rows.length>0?(a.rows.forEach((function(e){e.employee_id&&"common"!==e.employee_id&&n.set(e.employee_id,e)})),console.log("获取到".concat(n.size,"个特殊人员的加班规则"))):0!==a.code&&console.warn("获取特殊加班规则失败:",a.msg),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.warn("获取特殊加班规则失败，将使用通用规则:",t.t0);case 11:return t.abrupt("return",n);case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()},processRowDatas:function(){var e=arguments,t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r,i;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:[],r=e.length>1?e[1]:void 0,i=e.length>2?e[2]:void 0,n.prev=3,a.forEach((function(e){var n=e.attendance_ym_key;if(!n)throw new Error("无法确定考勤月份");var a="".concat(e.employee_id,"_").concat(n),o=r.get(a)||{};e.share_cost=o.share_cost||0,e.clothes_cost=o.clothes_cost||0,e.reward_cost=o.reward_cost||0,e.punish_cost=o.punish_cost||0,e.agency_fee=o.agency_fee||0,e.other_cost=o.other_cost||0;var s=t.computeCostsWithSpecial(e,i);e.overtime_cost=s.overtime_cost,e.earlytime_cost=s.earlytime_cost,e.missed_cost=s.missed_cost,e.enable_hr=!1,e.attendance_ym_key=n})),n.abrupt("return",a);case 8:return n.prev=8,n.t0=n["catch"](3),console.error("处理数据失败:",n.t0),n.abrupt("return",[]);case 12:case"end":return n.stop()}}),n,null,[[3,8]])})))()},computeCostsWithSpecial:function(e,t){var n=t.ll_data,a=t.com_data,r=t.specialOvertimeMap,i=e.employee_id,o=e.overtime_hours,s=void 0===o?0:o,l=e.earlytime_hours,c=void 0===l?0:l,u=e.missed_count,d=void 0===u?0:u,m=0;if(0!==s)if(r.has(i)){var y=r.get(i);m=s*(y.overtime_cost||20)}else{var p;m=s*((null===(p=a.rows[0])||void 0===p?void 0:p.overtime_cost)||20)}var h=0,f=(c-n.rows[0].late_min)*n.rows[0].late_price;f>0&&(h=f);var _=0,v=(d-n.rows[0].clock_min)*n.rows[0].clock_price;return v>0&&(_=v),{overtime_cost:m,earlytime_cost:h,missed_cost:_}},delay:function(e){return new Promise((function(t){return setTimeout(t,e)}))},addBtn:function(){this.resetForm(),this.form1.props.action="admin/hrm/attendance/sys/approve/add",this.form1.props.formType="add",this.form1.props.title="添加",this.form1.props.show=!0},updateBtn:function(e){var t=e.item;this.form1.props.action="admin/hrm/attendance/sys/approve/update",this.form1.props.formType="update",this.form1.props.title="编辑",this.form1.props.show=!0,this.form1.data=t},deleteBtn:function(e){var t=e.item,n=e.deleteFn;n({action:"admin/hrm/attendance/sys/approve/delete",data:{_id:t._id}})},batchBtn:function(e){var t=this;return(0,s.default)((0,o.default)().mark((function n(){return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:n.t0=e,n.next=1===n.t0?3:2===n.t0?8:13;break;case 3:return n.next=5,l.callFunction({url:"admin/hrm/attendance/sys/all/updateAll",title:"请求中...",data:{items:t.table1.multipleSelection,enable_hr:!0}});case 5:return n.sent,t.refresh(),n.abrupt("break",14);case 8:return n.next=10,l.callFunction({url:"admin/hrm/attendance/sys/all/updateAll",title:"请求中...",data:{items:t.table1.multipleSelection,enable_hr:!1}});case 10:return n.sent,t.refresh(),n.abrupt("break",14);case 13:return n.abrupt("break",14);case 14:case"end":return n.stop()}}),n)})))()}},watch:{},computed:{}};t.default=p},eca7:function(e,t,n){var a=n("3362");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var r=n("967d").default;r("7204e4e2",a,!0,{sourceMap:!1,shadowMode:!1})},ed52:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"page-body"},[n("vk-data-table-query",{attrs:{columns:e.queryForm1.columns},on:{search:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}},model:{value:e.queryForm1.formData,callback:function(t){e.$set(e.queryForm1,"formData",t)},expression:"queryForm1.formData"}}),n("v-uni-view",[n("el-row",[e.$hasRole("admin")||e.$hasPermission("hrm-attendance-add")?n("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addBtn.apply(void 0,arguments)}}},[e._v("添加")]):e._e(),e.$hasRole("admin")||e.$hasPermission("hrm-attendance-add")?n("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.autoBtn.apply(void 0,arguments)}}},[e._v("自动生成月考勤表")]):e._e(),e.$hasRole("admin")||e.$hasPermission("hrm-attendance-export")?n("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.exportExcelAll.apply(void 0,arguments)}}},[e._v(" 导出全部 ")]):e._e(),e.table1.multipleSelection&&(e.$hasRole("admin")||e.$hasPermission("hrm-attendance-add"))?n("el-dropdown",{attrs:{"split-button":!1,trigger:"click"},on:{command:function(t){arguments[0]=t=e.$handleEvent(t),e.batchBtn.apply(void 0,arguments)}}},[n("el-button",{staticStyle:{"margin-left":"20rpx"},attrs:{type:"danger",size:"small",disabled:0===e.table1.multipleSelection.length}},[e._v(" 批量审核"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:1}},[e._v("通过")])],1)],1):e._e()],1)],1),n("vk-data-table",{ref:"table1",attrs:{action:e.table1.action,columns:e.table1.columns,"query-form-param":e.queryForm1,"right-btns":e.table1.rightBtns,"data-preprocess":e.table1.dataPreprocess,selection:!0,"row-no":!1,pagination:!0},on:{update:function(t){arguments[0]=t=e.$handleEvent(t),e.updateBtn.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deleteBtn.apply(void 0,arguments)},"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.currentChange.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}}),n("vk-data-dialog",{attrs:{title:e.form1.props.title,width:"700px",mode:"form","close-on-click-modal":!1},model:{value:e.form1.props.show,callback:function(t){e.$set(e.form1.props,"show",t)},expression:"form1.props.show"}},[n("vk-data-form",{attrs:{rules:e.form1.props.rules,action:e.form1.props.action,"form-type":e.form1.props.formType,columns:e.form1.props.columns,"label-width":"100px",inline:!0,columnsNumber:2},on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.form1.props.show=!1,e.refresh()}},scopedSlots:e._u([{key:"share_cost",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.share_cost))])],1)]}},{key:"clothes_cost",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.clothes_cost))])],1)]}},{key:"reward_cost",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.reward_cost))])],1)]}},{key:"punish_cost",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.punish_cost))])],1)]}},{key:"agency_fee",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.agency_fee))])],1)]}},{key:"other_cost",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.other_cost))])],1)]}},{key:"marriage_leave",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.marriage_leave))])],1)]}},{key:"maternity_leave",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.maternity_leave))])],1)]}},{key:"paternity_leave",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.paternity_leave))])],1)]}},{key:"work_injury",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.work_injury))])],1)]}},{key:"sick_leave",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.sick_leave))])],1)]}},{key:"emergency_leave",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.emergency_leave))])],1)]}},{key:"allowance",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.allowance))])],1)]}},{key:"attendance_correction",fn:function(t){var a=t.form;return[n("v-uni-view",[n("v-uni-text",[e._v(e._s(a.attendance_correction))])],1)]}}]),model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1)],1)},r=[]}}]);