(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-hrm-salary-cost-listwe"],{"0d66":function(t,e,r){"use strict";r.r(e);var a=r("2d24"),i=r("847b");for(var n in i)["default"].indexOf(n)<0&&function(t){r.d(e,t,(function(){return i[t]}))}(n);r("8e3e");var o=r("828b"),c=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,"a1e1fb04",null,!1,a["a"],void 0);e["default"]=c.exports},"2d24":function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-uni-view",{staticClass:"page-body"},[r("vk-data-table-query",{attrs:{columns:t.queryForm1.columns},on:{search:function(e){arguments[0]=e=t.$handleEvent(e),t.search.apply(void 0,arguments)}},model:{value:t.queryForm1.formData,callback:function(e){t.$set(t.queryForm1,"formData",e)},expression:"queryForm1.formData"}}),r("v-uni-view",[r("el-row",[t.$hasRole("admin")||t.$hasPermission("hrm-attendance-config-add")?r("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.addBtn.apply(void 0,arguments)}}},[t._v("添加")]):t._e(),t.$hasRole("admin")||t.$hasPermission("hrm-attendance-config-add")?r("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.addDatas.apply(void 0,arguments)}}},[t._v("复制上月数据")]):t._e(),t.$hasRole("admin")||t.$hasPermission("hrm-attendance-config-add")?r("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit-outline"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.exportExcelAll.apply(void 0,arguments)}}},[t._v(" 导出全部 ")]):t._e()],1)],1),r("vk-data-table",{ref:"table1",attrs:{action:t.table1.action,columns:t.table1.columns,"query-form-param":t.queryForm1,"right-btns":t.table1.rightBtns,selection:!0,"row-no":!1,pagination:!0,"default-sort":{name:"dorms.location",type:"asc",name:"dorm_id",type:"asc"}},on:{update:function(e){arguments[0]=e=t.$handleEvent(e),t.updateBtn.apply(void 0,arguments)},delete:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteBtn.apply(void 0,arguments)},"current-change":function(e){arguments[0]=e=t.$handleEvent(e),t.currentChange.apply(void 0,arguments)},"selection-change":function(e){arguments[0]=e=t.$handleEvent(e),t.selectionChange.apply(void 0,arguments)}}}),r("vk-data-dialog",{attrs:{title:t.form1.props.title,width:"700px",mode:"form","close-on-click-modal":!1},model:{value:t.form1.props.show,callback:function(e){t.$set(t.form1.props,"show",e)},expression:"form1.props.show"}},[r("vk-data-form",{attrs:{rules:t.form1.props.rules,action:t.form1.props.action,"before-action":t.form1.props.beforeAction,"form-type":t.form1.props.formType,columns:t.form1.props.columns,"label-width":"100px",inline:!0,columnsNumber:2},on:{success:function(e){arguments[0]=e=t.$handleEvent(e),t.form1.props.show=!1,t.refresh()}},model:{value:t.form1.data,callback:function(e){t.$set(t.form1,"data",e)},expression:"form1.data"}})],1)],1)},i=[]},"847b":function(t,e,r){"use strict";r.r(e);var a=r("bb5e"),i=r.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){r.d(e,t,(function(){return a[t]}))}(n);e["default"]=i.a},"8aab":function(t,e,r){var a=r("c86c");e=a(!1),e.push([t.i,"",""]),t.exports=e},"8e3e":function(t,e,r){"use strict";var a=r("be88"),i=r.n(a);i.a},bb5e:function(t,e,r){"use strict";r("6a54");var a=r("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(r("3471")),n=a(r("2634")),o=a(r("2fdc"));r("c223"),r("fd3c"),r("5c47"),r("af8f");var c=uni.vk,l={},m=new Date(c.pubfn.getOffsetTime(new Date,{month:0,mode:"before"})).getFullYear(),d=new Date(c.pubfn.getOffsetTime(new Date,{month:0,mode:"before"})).getMonth();d=d>9?d:"0".concat(d);var u=c.myfn.normalizeMonth("".concat(m,"-").concat(d)),y=new Date(c.pubfn.getOffsetTime(new Date,{month:1,mode:"before"})).getFullYear(),p=new Date(c.pubfn.getOffsetTime(new Date,{month:1,mode:"before"})).getMonth();p=p>9?p:"0".concat(p);var f=c.myfn.normalizeMonth("".concat(y,"-").concat(p)),h={data:function(){var t=this;return{loading:!1,data:{},table1:{action:"admin/hrm/salary/sys/we/getList",rightBtns:[{mode:"detail_auto",title:"详细",show:function(e){return t.$hasRole("admin")||t.$hasPermission("hrm-attendance-config-view")}},{mode:"update",title:"编辑",show:function(e){return t.$hasRole("admin")||t.$hasPermission("hrm-attendance-config-edit")}},{mode:"delete",title:"删除",show:function(e){return t.$hasRole("admin")||t.$hasPermission("hrm-attendance-config-delete")}}],columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM"},{key:"employee_ids",title:"员工工号",type:"html",width:100,formatter:function(t,e,r,a){var i="<text>";return e.employees.map((function(t,e){i+=t.employee_id,i+="<br>"})),i+="</text>",i}},{key:"employee_names",title:"员工姓名",type:"html",width:100,formatter:function(t,e,r,a){var i="<text>";return e.employees.map((function(t,e){i+=t.employee_name,i+="<br>"})),i+="</text>",i}},{key:"dorm_id",title:"房号",type:"html",width:200,formatter:function(t,e,r,a){return"<text>".concat(e.dorm_id,"-").concat(e.dorms.location,"</text>")}},{key:"last_month_water",title:"上月数",precision:2,type:"number",width:100},{key:"current_month_water",title:"本月数",precision:2,type:"number",width:100},{key:"unit_price_water",title:"单价",precision:2,type:"number",width:100},{key:"water_cost",title:"水费",precision:2,type:"number",width:100},{key:"last_month_electricity",title:"上月数",precision:2,type:"number",width:100},{key:"current_month_electricity",title:"本月数",precision:2,type:"number",width:100},{key:"unit_price_electricity",title:"单价",precision:2,type:"number",width:100},{key:"electricity_cost",title:"电费",precision:2,type:"number",width:100},{key:"total_cost",title:"总计(元)",precision:2,type:"number",width:100},{key:"share_cost",title:"分摊(元/人)",precision:2,type:"number",width:100},{key:"comment",title:"备注",type:"text",width:200,show:["detail"]},{key:"update_date",title:"更新时间",type:"time",width:200,show:["detail"]},{key:"users.nickname",title:"更新人",type:"text",width:200,show:["detail"]}],multipleSelection:[],selectItem:""},queryForm1:{formData:{attendance_ym:u},columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM",mode:"="},{key:"empids",title:"",type:"table-select",placeholder:"选择员工",action:"admin/hrm/employees/sys/getList",multiple:!1,columns:[{key:"employee_id",title:"员工工号",type:"text",idKey:!0},{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0},{key:"card",title:"身份证号码",type:"text",nameKey:!0}],queryColumns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"%%"},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"card",title:"身份证号码",type:"text",width:200,mode:"%%"}]},{key:"dorm_id",title:"",type:"table-select",placeholder:"选择房号",action:"admin/hrm/dorm/sys/getList",multiple:!1,columns:[{key:"dorm_id",title:"房号",type:"text",show:["none"],idKey:!0},{key:"dorm_id",title:"房号",type:"text",nameKey:!0},{key:"dorm_rent",title:"租金",type:"number",nameKey:!0},{key:"location",title:"宿舍地址",type:"text",nameKey:!0}],queryColumns:[{key:"dorm_id",title:"房号",type:"text",width:150,mode:"%%"},{key:"dorm_rent",title:"租金",type:"number",width:150,mode:"%%"},{key:"location",title:"宿舍地址",type:"text",width:200,mode:"%%"}]}]},form1:{data:{attendance_ym:u},props:{beforeAction:function(e){return t.computeCost(e.water_cost,e.electricity_cost),e},action:"",columns:[{key:"",title:"基础资料",type:"bar-title"},{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM",width:200},{key:"dorm_id",title:"",type:"table-select",placeholder:"选择房号",action:"admin/hrm/dorm/sys/getList",multiple:!1,columns:[{key:"dorm_id",title:"房号",type:"text",show:["none"],idKey:!0},{key:"dorm_id",title:"房号",type:"text",nameKey:!0},{key:"dorm_rent",title:"租金",type:"number",nameKey:!0},{key:"location",title:"宿舍地址",type:"text",nameKey:!0}],queryColumns:[{key:"dorm_id",title:"房号",type:"text",width:150,mode:"%%"},{key:"dorm_rent",title:"租金",type:"number",width:150,mode:"%%"},{key:"location",title:"宿舍地址",type:"text",width:200,mode:"%%"}]},{key:"empids",title:"入住员工",type:"table-select",placeholder:"选择员工",action:"admin/hrm/employees/sys/getList",oneLine:!0,multiple:!0,columns:[{key:"employee_id",title:"员工工号",type:"text",idKey:!0},{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0},{key:"card",title:"身份证号码",type:"text",nameKey:!0}],queryColumns:[{key:"employee_id",title:"员工工号",type:"text",width:150,mode:"%%"},{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"card",title:"身份证号码",type:"text",width:200,mode:"%%"}]},{key:"",title:"水费",type:"bar-title"},{key:"last_month_water",title:"上月数",precision:2,type:"number",width:200},{key:"current_month_water",title:"本月数",precision:2,type:"number",width:200},{key:"unit_price_water",title:"单价",precision:2,type:"number",width:200},{key:"water_cost",title:"水费",precision:2,disabled:!0,type:"number",width:200},{key:"",title:"电费",type:"bar-title"},{key:"last_month_electricity",title:"上月数",precision:2,type:"number",width:200},{key:"current_month_electricity",title:"本月数",precision:2,type:"number",width:200},{key:"unit_price_electricity",title:"单价",precision:2,type:"number",width:200},{key:"electricity_cost",title:"电费",precision:2,type:"number",disabled:!0,width:200},{key:"",title:"总计、分摊费用",type:"bar-title"},{key:"total_cost",title:"总计(元)",precision:2,type:"number",disabled:!0,width:200},{key:"share_cost",title:"分摊(元/人)",precision:2,type:"number",disabled:!0,width:200},{key:"comment",title:"备注",type:"textarea",maxlength:"100",showWordLimit:!0,width:200,autosize:{minRows:4,maxRows:10}}],rules:{attendance_ym:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],dorm_id:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],empids:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],unit_price_water:[{validator:function(){var e=(0,o.default)((0,n.default)().mark((function e(r,a,i){var o,c,l;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=t.form1.data.last_month_water?t.form1.data.last_month_water:0,c=t.form1.data.current_month_water?t.form1.data.current_month_water:0,l=t.form1.data.unit_price_water?t.form1.data.unit_price_water:0,a=c-o,a>0?(a*=l,t.$set(t.form1.data,"water_cost",a)):(a=0,t.$set(t.form1.data,"water_cost",a)),t.computeCost(t.form1.data.water_cost,t.form1.data.electricity_cost);case 6:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),trigger:["blur","change"]}],last_month_water:[{validator:function(){var e=(0,o.default)((0,n.default)().mark((function e(r,a,i){var o,c,l;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=t.form1.data.last_month_water?t.form1.data.last_month_water:0,c=t.form1.data.current_month_water?t.form1.data.current_month_water:0,l=t.form1.data.unit_price_water?t.form1.data.unit_price_water:0,a=c-o,a>0?(a*=l,t.$set(t.form1.data,"water_cost",a)):(a=0,t.$set(t.form1.data,"water_cost",a)),t.computeCost(t.form1.data.water_cost,t.form1.data.electricity_cost);case 6:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),trigger:["blur","change"]}],current_month_water:[{validator:function(){var e=(0,o.default)((0,n.default)().mark((function e(r,a,i){var o,c,l;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=t.form1.data.last_month_water?t.form1.data.last_month_water:0,c=t.form1.data.current_month_water?t.form1.data.current_month_water:0,l=t.form1.data.unit_price_water?t.form1.data.unit_price_water:0,a=c-o,a>0?(a*=l,t.$set(t.form1.data,"water_cost",a)):(a=0,t.$set(t.form1.data,"water_cost",a)),t.computeCost(t.form1.data.water_cost,t.form1.data.electricity_cost);case 6:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),trigger:["blur","change"]}],unit_price_electricity:[{validator:function(){var e=(0,o.default)((0,n.default)().mark((function e(r,a,i){var o,c,l;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=t.form1.data.last_month_electricity?t.form1.data.last_month_electricity:0,c=t.form1.data.current_month_electricity?t.form1.data.current_month_electricity:0,l=t.form1.data.unit_price_electricity?t.form1.data.unit_price_electricity:0,a=c-o,a>0?(a*=l,t.$set(t.form1.data,"electricity_cost",a)):(a=0,t.$set(t.form1.data,"electricity_cost",a)),t.computeCost(t.form1.data.water_cost,t.form1.data.electricity_cost);case 6:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),trigger:["blur","change"]}],last_month_electricity:[{validator:function(){var e=(0,o.default)((0,n.default)().mark((function e(r,a,i){var o,c,l;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=t.form1.data.last_month_electricity?t.form1.data.last_month_electricity:0,c=t.form1.data.current_month_electricity?t.form1.data.current_month_electricity:0,l=t.form1.data.unit_price_electricity?t.form1.data.unit_price_electricity:0,a=c-o,a>0?(a*=l,t.$set(t.form1.data,"electricity_cost",a)):(a=0,t.$set(t.form1.data,"electricity_cost",a)),t.computeCost(t.form1.data.water_cost,t.form1.data.electricity_cost);case 6:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),trigger:["blur","change"]}],current_month_electricity:[{validator:function(){var e=(0,o.default)((0,n.default)().mark((function e(r,a,i){var o,c,l;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=t.form1.data.last_month_electricity?t.form1.data.last_month_electricity:0,c=t.form1.data.current_month_electricity?t.form1.data.current_month_electricity:0,l=t.form1.data.unit_price_electricity?t.form1.data.unit_price_electricity:0,a=c-o,a>0?(a*=l,t.$set(t.form1.data,"electricity_cost",a)):(a=0,t.$set(t.form1.data,"electricity_cost",a)),t.computeCost(t.form1.data.water_cost,t.form1.data.electricity_cost);case 6:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),trigger:["blur","change"]}]},formType:"",title:"",show:!1}},formDatas:{}}},onLoad:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c=this.vk,this.options=t,this.init(t)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{exportExcelAll:function(){this.$refs.table1.exportExcel({fileName:(new Date).getFullYear()+"人员水电费用信息",title:"正在导出数据...",columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM"},{key:"employee_ids",title:"员工工号",type:"text",formatter:function(t,e,r,a){var i="<text>";return e.employees.map((function(t,e){i+=t.employee_id,i+="<br>"})),i+="</text>",i}},{key:"employee_names",title:"员工姓名",type:"text",formatter:function(t,e,r,a){var i="<text>";return e.employees.map((function(t,e){i+=t.employee_name,i+="<br>"})),i+="</text>",i}},{key:"dorm_id",title:"房号",type:"text"},{key:"dorms.location",title:"宿舍地址",type:"text"},{key:"last_month_water",title:"上月数",precision:2,type:"number"},{key:"current_month_water",title:"本月数",precision:2,type:"number"},{key:"unit_price_water",title:"单价",precision:2,type:"number"},{key:"water_cost",title:"水费",precision:2,type:"number"},{key:"last_month_electricity",title:"上月数",precision:2,type:"number"},{key:"current_month_electricity",title:"本月数",precision:2,type:"number"},{key:"unit_price_electricity",title:"单价",precision:2,type:"number"},{key:"electricity_cost",title:"电费",precision:2,type:"number"},{key:"total_cost",title:"总计(元)",precision:2,type:"number"},{key:"share_cost",title:"分摊(元/人)",precision:2,type:"number"},{key:"comment",title:"备注",type:"text"}],pageIndex:1,pageSize:-1})},computeCost:function(t,e){var r,a=0,i=0;r=t+e,c.pubfn.isNotNull(this.form1.data.empids)&&(i=this.form1.data.empids.length||0),a=r>0&&i>0?r/i:r,this.$set(this.form1.data,"total_cost",r),this.$set(this.form1.data,"share_cost",c.pubfn.toDecimal(a,2))},addDatas:function(){var t=this;return(0,o.default)((0,n.default)().mark((function e(){return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:c.confirm("确定将删除".concat(u,"月全部数据，重新生成新数据！"),"提示","确定","取消",function(){var e=(0,o.default)((0,n.default)().mark((function e(r){var a,o,l,m,d;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r.confirm){e.next=35;break}return e.next=3,c.callFunction({url:"admin/hrm/salary/sys/we/getCopyList",title:"请求中...",data:{attendance_ym:f}});case 3:if(a=e.sent,0!=a.total){e.next=6;break}return e.abrupt("return",c.alert("没有上月数据，请联系相关人员！"));case 6:return e.next=8,c.callFunction({url:"admin/hrm/salary/sys/we/delete",title:"请求中...",data:{attendance_ym:u}});case 8:if(o=e.sent,0!=o.code){e.next=34;break}l=(0,i.default)(a.rows),e.prev=11,l.s();case 13:if((m=l.n()).done){e.next=22;break}return d=m.value,d.attendance_ym=u,d.last_month_electricity=d.current_month_electricity,e.next=19,c.callFunction({url:"admin/hrm/salary/sys/we/add",title:"请求中...",data:d});case 19:e.sent;case 20:e.next=13;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e["catch"](11),l.e(e.t0);case 27:return e.prev=27,l.f(),e.finish(27);case 30:c.alert("复制".concat(f,"月").concat(a.total,"条数据成功!"),"提示","确定"),t.refresh(),e.next=35;break;case 34:return e.abrupt("return",c.alert("删除数据出错(id:".concat(s._id,")!")));case 35:case"end":return e.stop()}}),e,null,[[11,24,27,30]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))()},init:function(t){l["form1"]=c.pubfn.copyObject(this.form1)},pageTo:function(t){c.navigateTo(t)},resetForm:function(){c.pubfn.resetForm(l,this)},search:function(){this.$refs.table1.search()},refresh:function(){this.$refs.table1.refresh()},getCurrentRow:function(){return this.$refs.table1.getCurrentRow()},currentChange:function(t){this.table1.selectItem=t},selectionChange:function(t){this.table1.multipleSelection=t},addBtn:function(){this.resetForm(),this.form1.props.action="admin/hrm/salary/sys/we/add",this.form1.props.formType="add",this.form1.props.title="添加",this.form1.props.show=!0},updateBtn:function(t){var e=t.item;this.form1.props.action="admin/hrm/salary/sys/we/update",this.form1.props.formType="update",this.form1.props.title="编辑",this.form1.props.show=!0,this.form1.data=e},deleteBtn:function(t){var e=t.item,r=t.deleteFn;r({action:"admin/hrm/salary/sys/we/delete",data:{_id:e._id}})},batchBtn:function(t){switch(t){case 1:c.toast("批量操作按钮1");break;case 2:c.toast("批量操作按钮2");break;default:break}}},watch:{},computed:{}};e.default=h},be88:function(t,e,r){var a=r("8aab");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=r("967d").default;i("639e26c7",a,!0,{sourceMap:!1,shadowMode:!1})}}]);