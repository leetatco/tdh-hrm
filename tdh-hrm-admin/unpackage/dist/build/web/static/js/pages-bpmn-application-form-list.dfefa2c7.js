(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-bpmn-application-form-list"],{"1aba":function(e,t,a){var n=a("c86c");t=n(!1),t.push([e.i,".page-body[data-v-6c85cc0f]{padding:%?20?%}.button-group[data-v-6c85cc0f]{margin-bottom:%?20?%;padding:%?20?%;background:#fff;border-radius:%?8?%;-webkit-box-shadow:0 %?2?% %?6?% rgba(0,0,0,.1);box-shadow:0 %?2?% %?6?% rgba(0,0,0,.1)}.batch-approve-content .batch-info[data-v-6c85cc0f]{margin-bottom:16px}.withdraw-dialog-content .el-alert[data-v-6c85cc0f]{margin-bottom:20px}",""]),e.exports=t},3036:function(e,t,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("4626"),a("5ac7"),a("9327"),a("5c47"),a("0506"),a("bf0f"),a("2797"),a("aa77"),a("fd3c"),a("af8f"),a("dc8a");var r=n(a("9b1b")),o=n(a("2634")),i=n(a("2fdc")),l=n(a("7564")),s=n(a("2371")),c=n(a("1bb4")),u=n(a("4630")),d=n(a("979ad")),p=n(a("68e6")),f=uni.vk,m={name:"TaskCenter",components:{ApproeWorkFlow:l.default,DynamicFormDialog:s.default,FilePreviewDialog:c.default,ApproveHeaderDetail:u.default,ReturnHandleDialog:d.default,ApproveHandleDialog:p.default},data:function(){var e=this;return{formDatas:{},loading:!0,saveFormLoading:!1,formTypeConfigs:{},processFlow:{tasks:[],instance:null},dynamicFormDialog:{show:!1,title:"",formSchema:null,formTypeCode:"",data:null},filePreview:{show:!1,data:{url:"",name:"",type:""}},table1:{action:"admin/bpmn/task/sys/getList",customRightBtns:[{mode:"detail_auto",title:"è¯¦ç»†",icon:"el-icon-tickets",onClick:function(t){e.showDetail(t)}},{mode:"update",title:"å¤„ç†",icon:"el-icon-edit",type:"primary",show:function(t){return e.canHandleTask(t)&&"return"!==t.node_type},onClick:function(t){e.showApproveDialog(t)}},{mode:"update",title:"å¤„ç†é€€å›",type:"warning",icon:"el-icon-refresh-right",show:function(t){return"return"===t.node_type&&e.canHandleReturnTask(t)},onClick:function(t){e.handleReturnTask(t)}},{mode:"update",title:"è½¬åŠ",type:"warning",icon:"el-icon-user",show:function(t){return e.canTransferTask(t)&&"return"!==t.node_type},onClick:function(t){e.handleTransfer(t)}}],columns:[{key:"task_name",title:"ä»»åŠ¡åç§°",type:"text",width:150,showOverflowTooltip:!0,formatter:function(e,t){return"return"===t.node_type?"ğŸ”„ ".concat(e):e}},{key:"application_title",title:"ç”³è¯·æ ‡é¢˜",type:"text",width:200,showOverflowTooltip:!0},{key:"form_type_code",title:"ç”³è¯·ç±»å‹",type:"text",width:120,formatter:function(t){return e.getFormTypeName(t)||t}},{key:"applicant_name",title:"ç”³è¯·äºº",type:"text",width:100},{key:"applicant_department",title:"ç”³è¯·éƒ¨é—¨",type:"text",width:120},{key:"_add_time",title:"åˆ°è¾¾æ—¶é—´",type:"time",width:180},{key:"due_date",title:"æˆªæ­¢æ—¶é—´",type:"html",formatter:function(e,t){if(!e)return"-";var a=Date.now(),n=new Date(e).getTime(),r=Math.ceil((n-a)/36e5);return r<0?'<text style="color:#F56C6C">å·²è¶…æ—¶ '.concat(Math.abs(r),"å°æ—¶</text>"):r<24?'<text style="color:#E6A23C">å‰©ä½™ '.concat(r,"å°æ—¶</text>"):f.pubfn.timeFormat(e,"yyyy-MM-dd hh:mm")}},{key:"node_type",title:"ä»»åŠ¡ç±»å‹",type:"text",width:100,formatter:function(e){return{userTask:"æ™®é€šä»»åŠ¡",approval:"å®¡æ‰¹ä»»åŠ¡",return:"é€€å›ä»»åŠ¡"}[e]||e}}],multipleSelection:[],selectItem:""},queryForm1:{formData:{status:"pending"},columns:[{key:"application_title",title:"ç”³è¯·æ ‡é¢˜",type:"text",width:200,mode:"%%"},{key:"applicant_name",title:"ç”³è¯·äºº",type:"text",width:100,mode:"%%"},{key:"form_type_code",title:"ç”³è¯·ç±»å‹",type:"select",width:150,mode:"=",data:[]},{key:"_add_time",title:"åˆ°è¾¾æ—¶é—´",type:"datetimerange",width:300,mode:"[]"}]},approveDialog:{approvalHistory:[],show:!1,title:"å®¡æ‰¹å¤„ç†"},approveLoading:!1,currentApplication:null,currentTask:null,showReturnOption:!0,showTransferOption:!0,showAddSignOption:!1,detailDialog:{show:!1,title:"ç”³è¯·è¯¦æƒ…",data:null,approvalHistory:[],currentTasks:[],processFlow:{tasks:[]}},batchApproveDialog:{show:!1,selectedItems:[]},batchApproveForm:{action:"approve",comment:""},batchApproveRules:{action:[{required:!0,message:"è¯·é€‰æ‹©å®¡æ‰¹æ“ä½œ",trigger:["blur","change"]}],comment:[{required:!0,message:"è¯·è¾“å…¥å®¡æ‰¹æ„è§",trigger:["blur","change"]}]},batchApproveLoading:!1,returnDialog:{show:!1,title:"é€€å›å¤„ç†",task:null,application:null},returnLoading:!1,statusHistory:[],withdrawDialog:{show:!1,data:null},withdrawForm:{reason:""},withdrawRules:{reason:[{required:!0,message:"è¯·å¡«å†™æ’¤å›åŸå› ",trigger:["blur","change"]}]},withdrawLoading:!1}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f=this.vk,this.options=e,this.init(e)},methods:{openForm:function(e,t){this.vk;this.$set(this.formDatas,e,t)},init:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function e(){return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,t.loadFormTypes();case 4:e.next=10;break;case 6:e.prev=6,e.t0=e["catch"](0),console.error("åˆå§‹åŒ–å¤±è´¥:",e.t0),t.$message.error("é¡µé¢åˆå§‹åŒ–å¤±è´¥");case 10:return e.prev=10,t.loading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,6,10,13]])})))()},previewFile:function(e){e&&e.url?(this.filePreview.data={url:e.url,name:e.name,type:this.getFileType(e)},this.filePreview.show=!0):this.$message.warning("æ–‡ä»¶åœ°å€æ— æ•ˆ")},downloadFile:function(e){if(e&&e.url){var t=document.createElement("a");t.href=e.url,t.download=e.name||"download",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t),this.$message.success("å¼€å§‹ä¸‹è½½æ–‡ä»¶")}else this.$message.warning("æ–‡ä»¶åœ°å€æ— æ•ˆ")},getFileType:function(e){if(!e)return"unknown";var t=e.name||"",a=e.type||"";return a.includes("pdf")||t.toLowerCase().endsWith(".pdf")?"pdf":a.includes("image")||/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(t)?"image":a.includes("text")||/\.(txt|md)$/i.test(t)?"text":"other"},loadFormTypes:function(){var e=this;return(0,i.default)((0,o.default)().mark((function t(){var a,n;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.vk.callFunction({url:"admin/bpmn/form-type/sys/getList",data:{pageSize:100}});case 3:a=t.sent,0===a.code&&a.rows&&(a.rows.forEach((function(t){e.formTypeConfigs[t.code]=t})),n=e.queryForm1.columns.find((function(e){return"form_type_code"===e.key})),n&&(n.data=a.rows.map((function(e){return{value:e.code,label:e.name}})))),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("åŠ è½½è¡¨å•ç±»å‹å¤±è´¥:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getFormTypeSchema:function(e){var t=this.formTypeConfigs[e];return t&&t.form_schema?JSON.parse(t.form_schema):null},getFormTypeName:function(e){var t=this.formTypeConfigs[e];return t?t.name:e},getStatusType:function(e){return{draft:"info",pending:"warning",approved:"success",rejected:"danger",cancelled:"info",withdrawn:"info",returned:"warning"}[e]||"info"},getStatusText:function(e){return{draft:"è‰ç¨¿",pending:"å®¡æ‰¹ä¸­",approved:"å·²é€šè¿‡",rejected:"å·²é©³å›",cancelled:"å·²å–æ¶ˆ",withdrawn:"å·²æ’¤å›",returned:"å·²é€€å›"}[e]||e},formatDate:function(e){return e?f.pubfn.timeFormat(e,"yyyy-MM-dd hh:mm:ss"):"-"},search:function(){this.$refs.table1.search()},refresh:function(){this.$refs.table1.refresh()},currentChange:function(e){this.table1.selectItem=e},selectionChange:function(e){this.table1.multipleSelection=e},canHandleTask:function(e){var t=f.getVuex("$user.userInfo");return e.assignee===t.username||e.candidate_users&&e.candidate_users.includes(t.username)||e.candidate_groups&&e.candidate_groups.some((function(e){return t.role&&t.role.includes(e)}))},canHandleReturnTask:function(e){var t=f.getVuex("$user.userInfo");return"return"===e.node_type&&e.assignee===t.username},canTransferTask:function(e){var t=f.getVuex("$user.userInfo");return e.assignee===t.username},showDetail:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n,r;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.vk.callFunction({url:"admin/bpmn/application-form/pub/detail",data:{userInfo:f.getVuex("$user.userInfo"),_id:e.application_id}});case 3:if(n=a.sent,0!==n.code){a.next=16;break}return t.detailDialog.data=n.data.application,t.detailDialog.approvalHistory=n.data.history||[],t.detailDialog.title="".concat(t.getFormTypeName(n.data.application.form_type_code)," - ç”³è¯·è¯¦æƒ…"),a.next=10,t.vk.callFunction({url:"admin/bpmn/task/sys/getList",data:{formData:{application_id:e.application_id,status:"pending"}}});case 10:return r=a.sent,t.detailDialog.currentTasks=0===r.code?r.rows:[],a.next=14,t.loadProcessFlow(e.application_id,"detail");case 14:a.next=20;break;case 16:t.detailDialog.data=e,t.detailDialog.approvalHistory=[],t.detailDialog.currentTasks=[],t.detailDialog.title="ç”³è¯·è¯¦æƒ…";case 20:a.next=29;break;case 22:a.prev=22,a.t0=a["catch"](0),console.error("åŠ è½½è¯¦æƒ…å¤±è´¥:",a.t0),t.detailDialog.data=e,t.detailDialog.approvalHistory=[],t.detailDialog.currentTasks=[],t.detailDialog.title="ç”³è¯·è¯¦æƒ…";case 29:t.detailDialog.show=!0;case 30:case"end":return a.stop()}}),a,null,[[0,22]])})))()},loadProcessFlow:function(e){var t=arguments,a=this;return(0,i.default)((0,o.default)().mark((function n(){var r,i;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:"approve",n.prev=1,n.next=4,a.vk.callFunction({url:"admin/bpmn/task/sys/getList",data:{formData:{application_id:e},orderBy:"sequence asc"}});case 4:i=n.sent,0===i.code&&("approve"===r?a.processFlow.tasks=i.rows||[]:a.detailDialog.processFlow.tasks=i.rows||[]),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](1),console.error("åŠ è½½å®¡æ‰¹æµç¨‹å¤±è´¥:",n.t0);case 11:case"end":return n.stop()}}),n,null,[[1,8]])})))()},showApproveDialog:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.currentTask=e,a.prev=1,a.next=4,t.vk.callFunction({url:"admin/bpmn/application-form/pub/detail",data:{userInfo:f.getVuex("$user.userInfo"),_id:e.application_id}});case 4:if(n=a.sent,0!==n.code){a.next=17;break}return t.currentApplication=n.data.application,t.approveDialog.title="".concat(t.getFormTypeName(t.currentApplication.form_type_code)," - å®¡æ‰¹å¤„ç†"),t.approveDialog.approvalHistory=n.data.history,t.showReturnOption="start"!==e.task_key,t.showTransferOption=!0,t.showAddSignOption=!0===e.allow_add_sign,a.next=14,t.loadProcessFlow(e.application_id);case 14:t.approveDialog.show=!0,a.next=18;break;case 17:t.$message.error("è·å–ç”³è¯·è¯¦æƒ…å¤±è´¥");case 18:a.next=24;break;case 20:a.prev=20,a.t0=a["catch"](1),console.error("è·å–ç”³è¯·è¯¦æƒ…å¤±è´¥:",a.t0),t.$message.error("è·å–ç”³è¯·è¯¦æƒ…å¤±è´¥");case 24:case"end":return a.stop()}}),a,null,[[1,20]])})))()},onActionChange:function(e){this.showAddSignOption="approve"===e&&(this.currentTask&&!0===this.currentTask.allow_add_sign)},handleApproveSubmit:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n,i;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.approveLoading=!0,n=(0,r.default)((0,r.default)({},e),{},{userInfo:f.getVuex("$user.userInfo")}),console.log("completeData:",n),a.next=6,t.vk.callFunction({url:"admin/bpmn/task/pub/complete",data:n});case 6:i=a.sent,0===i.code?(t.$message.success("å¤„ç†æˆåŠŸ"),t.approveDialog.show=!1,t.refresh()):t.$message.error(i.msg||"å¤„ç†å¤±è´¥"),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),console.error("å¤„ç†å¤±è´¥:",a.t0),a.t0.message?t.$message.error(a.t0.message):t.$message.error("å¤„ç†å¤±è´¥");case 14:return a.prev=14,t.approveLoading=!1,a.finish(14);case 17:case"end":return a.stop()}}),a,null,[[0,10,14,17]])})))()},handleTransfer:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,n=f.getVuex("$user.userInfo"),e.assignee===n.username){a.next=5;break}return t.$message.error("åªæœ‰å½“å‰ä»»åŠ¡å¤„ç†äººå¯ä»¥è½¬äº¤ä»»åŠ¡"),a.abrupt("return");case 5:return a.next=7,t.showApproveDialog(e);case 7:a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),console.error("è½¬äº¤ä»»åŠ¡å¤±è´¥:",a.t0),t.$message.error("è½¬äº¤ä»»åŠ¡å¤±è´¥: "+(a.t0.message||"æœªçŸ¥é”™è¯¯"));case 13:case"end":return a.stop()}}),a,null,[[0,9]])})))()},canHandleCurrentTask:function(e){var t=f.getVuex("$user.userInfo"),a=this.detailDialog.currentTasks[0];return!(!e||!this.detailDialog.currentTasks||0===this.detailDialog.currentTasks.length||"return"==a.node_type)&&(console.log("currentTask:",a),a.assignee===t.username||a.candidate_users&&a.candidate_users.includes(t.username))},handleTaskFromDetail:function(e){if(this.detailDialog.currentTasks&&this.detailDialog.currentTasks.length>0){var t=this.detailDialog.currentTasks[0];this.showApproveDialog(t),this.detailDialog.show=!1}},showBatchApproveDialog:function(){var e=this.table1.multipleSelection;0!==e.length?(this.batchApproveDialog.selectedItems=e,this.batchApproveForm={action:"approve",comment:""},this.batchApproveDialog.show=!0):this.$message.warning("è¯·é€‰æ‹©è¦å¤„ç†çš„å¾…åŠä»»åŠ¡")},handleBatchApprove:function(){var e=this;return(0,i.default)((0,o.default)().mark((function t(){var a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.batchApproveFormRef.validate();case 3:return e.batchApproveLoading=!0,t.next=6,e.vk.callFunction({url:"admin/bpmn/task/sys/batchComplete",data:{task_ids:e.batchApproveDialog.selectedItems.map((function(e){return e._id})),action:e.batchApproveForm.action,comment:e.batchApproveForm.comment}});case 6:a=t.sent,0===a.code?(e.$message.success("æ‰¹é‡å¤„ç†æˆåŠŸï¼Œå…±å¤„ç† ".concat(a.data.processed_count," ä¸ªä»»åŠ¡")),e.batchApproveDialog.show=!1,e.table1.multipleSelection=[],e.refresh()):e.$message.error(a.msg||"æ‰¹é‡å¤„ç†å¤±è´¥"),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("æ‰¹é‡å¤„ç†å¤±è´¥:",t.t0),e.$message.error("æ‰¹é‡å¤„ç†å¤±è´¥");case 14:return t.prev=14,e.batchApproveLoading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,10,14,17]])})))()},handleReturnTask:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n,r;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,"return"===e.node_type){a.next=4;break}return t.$message.error("è¯¥ä»»åŠ¡ä¸æ˜¯é€€å›ä»»åŠ¡"),a.abrupt("return");case 4:if(n=f.getVuex("$user.userInfo"),e.assignee===n.username){a.next=8;break}return t.$message.error("åªæœ‰ç”³è¯·äººå¯ä»¥å¤„ç†é€€å›ä»»åŠ¡"),a.abrupt("return");case 8:return t.returnDialog.task=e,a.next=11,t.vk.callFunction({url:"admin/bpmn/application-form/pub/detail",data:{userInfo:n,_id:e.application_id}});case 11:r=a.sent,0===r.code?t.returnDialog.application=r.data.application:t.returnDialog.application=null,t.returnDialog.title="é€€å›å¤„ç† - ".concat(t.getFormTypeName(e.form_type_code)),t.returnDialog.show=!0,a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](0),console.error("å¤„ç†é€€å›ä»»åŠ¡å¤±è´¥:",a.t0),t.$message.error("å¤„ç†é€€å›ä»»åŠ¡å¤±è´¥: "+(a.t0.message||"æœªçŸ¥é”™è¯¯"));case 21:case"end":return a.stop()}}),a,null,[[0,17]])})))()},editApplicationContent:function(){if(this.returnDialog.application){var e=this.returnDialog.application,t=e.form_type_code,a=this.getFormTypeSchema(t);if(a){var n=(0,r.default)({},e);e.form_data&&Object.keys(e.form_data).forEach((function(t){n[t]=e.form_data[t]})),console.log("é‡ç»„åçš„æ•°æ®:",n),this.dynamicFormDialog={show:!0,title:"ä¿®æ”¹ç”³è¯·ä¿¡æ¯ - ".concat(this.getFormTypeName(t)),formSchema:a,formTypeCode:t,data:n},this.openForm("dynamicFormDialog",this.dynamicFormDialog)}else this.$message.error("è¡¨å•é…ç½®ä¸å­˜åœ¨")}else this.$message.error("ç”³è¯·ä¿¡æ¯ä¸å­˜åœ¨")},handleDynamicFormSave:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.saveFormLoading=!0,"admin/bpmn/application-form/sys/update",a.next=5,t.vk.callFunction({url:"admin/bpmn/application-form/sys/update",data:e});case 5:n=a.sent,0===n.code?(t.returnDialog.application&&(t.returnDialog.application=(0,r.default)((0,r.default)({},t.returnDialog.application),e)),t.$message.success("ç”³è¯·ä¿¡æ¯ä¿®æ”¹æˆåŠŸ"),t.dynamicFormDialog.show=!1):t.$message.error(n.msg||"ä¿å­˜ç”³è¯·ä¿¡æ¯å¤±è´¥"),a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),console.error("ä¿å­˜ç”³è¯·ä¿¡æ¯å¤±è´¥:",a.t0),t.$message.error("ä¿å­˜ç”³è¯·ä¿¡æ¯å¤±è´¥");case 13:return a.prev=13,t.saveFormLoading=!1,a.finish(13);case 16:case"end":return a.stop()}}),a,null,[[0,9,13,16]])})))()},handleDynamicFormCancel:function(){this.dynamicFormDialog.show=!1},handleReturnSubmit:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.returnLoading=!0,a.next=4,t.vk.callFunction({url:"admin/bpmn/task/pub/handleReturn",data:(0,r.default)((0,r.default)({},e),{},{userInfo:f.getVuex("$user.userInfo")})});case 4:n=a.sent,0===n.code?(t.$message.success("å¤„ç†æˆåŠŸ"),t.returnDialog.show=!1,t.refresh(),"resubmit"===e.action?t.$message.success("ç”³è¯·å·²é‡æ–°æäº¤ï¼Œç­‰å¾…å®¡æ‰¹"):"withdraw"===e.action&&t.$message.success("ç”³è¯·å·²æ’¤å›")):t.$message.error(n.msg||"å¤„ç†å¤±è´¥"),a.next=12;break;case 8:a.prev=8,a.t0=a["catch"](0),console.error("å¤„ç†å¤±è´¥:",a.t0),t.$message.error("å¤„ç†å¤±è´¥");case 12:return a.prev=12,t.returnLoading=!1,a.finish(12);case 15:case"end":return a.stop()}}),a,null,[[0,8,12,15]])})))()},hasReturnTask:function(e){return!(!e||!this.detailDialog.currentTasks)&&this.detailDialog.currentTasks.some((function(e){return"return"===e.node_type}))},handleReturnTaskFromDetail:function(e){var t=this.detailDialog.currentTasks.find((function(e){return"return"===e.node_type}));t&&(this.handleReturnTask(t),this.detailDialog.show=!1)},canWithdrawApplication:function(e){if(!e)return!1;var t=f.getVuex("$user.userInfo");return e.applicant_id===t.username&&("pending"===e.status||"returned"===e.status)},handleWithdrawApplication:function(e){this.withdrawDialog.data=e,this.withdrawForm.reason="",this.withdrawDialog.show=!0},handleWithdrawConfirm:function(){var e=this;return(0,i.default)((0,o.default)().mark((function t(){var a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.withdrawFormRef.validate();case 3:return e.withdrawLoading=!0,t.next=6,e.vk.callFunction({url:"admin/bpmn/task/pub/handleReturn",data:{application_id:e.withdrawDialog.data._id,reason:e.withdrawForm.reason,userInfo:f.getVuex("$user.userInfo")}});case 6:a=t.sent,0===a.code?(e.$message.success("ç”³è¯·å·²æ’¤å›"),e.withdrawDialog.show=!1,e.detailDialog.show=!1,e.refresh()):e.$message.error(a.msg||"æ’¤å›å¤±è´¥"),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("æ’¤å›å¤±è´¥:",t.t0),e.$message.error("æ’¤å›å¤±è´¥");case 14:return t.prev=14,e.withdrawLoading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,10,14,17]])})))()}}};t.default=m},"5a70":function(e,t,a){"use strict";a.r(t);var n=a("3036"),r=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},"84ed":function(e,t,a){var n=a("1aba");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=a("967d").default;r("19fb8c4a",n,!0,{sourceMap:!1,shadowMode:!1})},9632:function(e,t,a){"use strict";var n=a("84ed"),r=a.n(n);r.a},ba67:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return n}));var n={approveHandleDialog:a("68e6").default,approveHeaderDetail:a("4630").default,returnHandleDialog:a("979ad").default,dynamicFormDialog:a("2371").default,filePreviewDialog:a("1bb4").default},r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"page-body"},[a("vk-data-table-query",{attrs:{columns:e.queryForm1.columns},on:{search:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}},scopedSlots:e._u([{key:"_add_time",fn:function(){return[a("vk-data-input-date-time",{attrs:{type:"daterange"},model:{value:e.queryForm1.formData._add_time,callback:function(t){e.$set(e.queryForm1.formData,"_add_time",t)},expression:"queryForm1.formData._add_time"}})]},proxy:!0}]),model:{value:e.queryForm1.formData,callback:function(t){e.$set(e.queryForm1,"formData",t)},expression:"queryForm1.formData"}}),a("v-uni-view",{staticClass:"button-group"},[a("el-row",[a("el-button",{attrs:{type:"warning",size:"small",icon:"el-icon-refresh",loading:e.loading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.refresh.apply(void 0,arguments)}}},[e._v(" åˆ·æ–° ")]),e.table1.multipleSelection.length>0?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-s-operation"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showBatchApproveDialog.apply(void 0,arguments)}}},[e._v(" æ‰¹é‡å¤„ç† ("+e._s(e.table1.multipleSelection.length)+") ")]):e._e()],1)],1),e.loading?a("el-skeleton",{attrs:{rows:10,animated:!0}}):a("vk-data-table",{ref:"table1",attrs:{action:e.table1.action,columns:e.table1.columns,"query-form-param":e.queryForm1,"custom-right-btns":e.table1.customRightBtns,selection:!0,"row-no":!0,pagination:!0},on:{"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.currentChange.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}}),a("approve-handle-dialog",{attrs:{title:e.approveDialog.title,task:e.currentTask,application:e.currentApplication,"form-schema":e.getFormTypeSchema(e.currentApplication?e.currentApplication.form_type_code:""),"process-info":e.approveDialog.processFlow,"approval-history":e.approveDialog.approvalHistory,"form-type-configs":e.formTypeConfigs,"show-return-option":e.showReturnOption,"show-transfer-option":e.showTransferOption,"show-add-sign-option":e.showAddSignOption,loading:e.approveLoading},on:{"preview-file":function(t){arguments[0]=t=e.$handleEvent(t),e.previewFile.apply(void 0,arguments)},"download-file":function(t){arguments[0]=t=e.$handleEvent(t),e.downloadFile.apply(void 0,arguments)},"action-change":function(t){arguments[0]=t=e.$handleEvent(t),e.onActionChange.apply(void 0,arguments)},submit:function(t){arguments[0]=t=e.$handleEvent(t),e.handleApproveSubmit.apply(void 0,arguments)}},model:{value:e.approveDialog.show,callback:function(t){e.$set(e.approveDialog,"show",t)},expression:"approveDialog.show"}}),a("vk-data-dialog",{attrs:{title:e.detailDialog.title,width:"900px"},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.detailDialog.show=!1}}},[e._v("å…³é—­")]),e.canHandleCurrentTask(e.detailDialog.data)?a("el-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleTaskFromDetail(e.detailDialog.data)}}},[e._v("ç«‹å³å¤„ç†")]):e._e(),e.hasReturnTask(e.detailDialog.data)?a("el-button",{attrs:{type:"warning"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleReturnTaskFromDetail(e.detailDialog.data)}}},[e._v("å¤„ç†é€€å›")]):e._e(),e.canWithdrawApplication(e.detailDialog.data)?a("el-button",{attrs:{type:"danger"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleWithdrawApplication(e.detailDialog.data)}}},[e._v("æ’¤å›ç”³è¯·")]):e._e()]},proxy:!0}]),model:{value:e.detailDialog.show,callback:function(t){e.$set(e.detailDialog,"show",t)},expression:"detailDialog.show"}},[a("approve-header-detail",{attrs:{"detail-data":e.detailDialog.data,"form-schema":e.getFormTypeSchema(e.detailDialog.data?e.detailDialog.data.form_type_code:""),"process-info":e.detailDialog.processFlow,"status-history":e.detailDialog.approvalHistory,"current-tasks":e.detailDialog.currentTasks,"show-basic-info":!0,"show-return-info":!1,"show-approval-flow":!0,"show-current-task":!0,"show-handle-form":!1,"form-type-configs":e.formTypeConfigs},on:{"preview-file":function(t){arguments[0]=t=e.$handleEvent(t),e.previewFile.apply(void 0,arguments)},"download-file":function(t){arguments[0]=t=e.$handleEvent(t),e.downloadFile.apply(void 0,arguments)}}})],1),a("vk-data-dialog",{attrs:{title:"æ‰¹é‡å®¡æ‰¹",width:"500px"},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.batchApproveDialog.show=!1}}},[e._v("å–æ¶ˆ")]),a("el-button",{attrs:{type:"primary",loading:e.batchApproveLoading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleBatchApprove.apply(void 0,arguments)}}},[e._v("ç¡®å®š")])]},proxy:!0}]),model:{value:e.batchApproveDialog.show,callback:function(t){e.$set(e.batchApproveDialog,"show",t)},expression:"batchApproveDialog.show"}},[a("v-uni-view",{staticClass:"batch-approve-content"},[a("v-uni-view",{staticClass:"batch-info"},[a("el-alert",{attrs:{type:"info",closable:!1}},[e._v(" å·²é€‰æ‹© "+e._s(e.batchApproveDialog.selectedItems.length)+" ä¸ªå¾…åŠä»»åŠ¡ ")])],1),a("el-form",{ref:"batchApproveFormRef",attrs:{model:e.batchApproveForm,rules:e.batchApproveRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"å®¡æ‰¹æ“ä½œ",prop:"action",required:!0}},[a("el-radio-group",{model:{value:e.batchApproveForm.action,callback:function(t){e.$set(e.batchApproveForm,"action",t)},expression:"batchApproveForm.action"}},[a("el-radio",{attrs:{label:"approve"}},[e._v("æ‰¹é‡åŒæ„")]),a("el-radio",{attrs:{label:"reject"}},[e._v("æ‰¹é‡é©³å›")])],1)],1),a("el-form-item",{attrs:{label:"å®¡æ‰¹æ„è§",prop:"comment",required:!0}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥ç»Ÿä¸€çš„å®¡æ‰¹æ„è§",maxlength:"200","show-word-limit":!0},model:{value:e.batchApproveForm.comment,callback:function(t){e.$set(e.batchApproveForm,"comment",t)},expression:"batchApproveForm.comment"}})],1)],1)],1)],1),a("return-handle-dialog",{attrs:{title:e.returnDialog.title,task:e.returnDialog.task,application:e.returnDialog.application,"form-schema":e.getFormTypeSchema(e.returnDialog.application?e.returnDialog.application.form_type_code:""),"process-info":e.returnDialog.processFlow,"status-history":e.returnDialog.statusHistory,"form-type-configs":e.formTypeConfigs,loading:e.returnLoading},on:{"preview-file":function(t){arguments[0]=t=e.$handleEvent(t),e.previewFile.apply(void 0,arguments)},"download-file":function(t){arguments[0]=t=e.$handleEvent(t),e.downloadFile.apply(void 0,arguments)},"edit-application":function(t){arguments[0]=t=e.$handleEvent(t),e.editApplicationContent.apply(void 0,arguments)},submit:function(t){arguments[0]=t=e.$handleEvent(t),e.handleReturnSubmit.apply(void 0,arguments)}},model:{value:e.returnDialog.show,callback:function(t){e.$set(e.returnDialog,"show",t)},expression:"returnDialog.show"}}),a("vk-data-dialog",{attrs:{title:"æ’¤å›ç”³è¯·ç¡®è®¤",width:"500px"},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.withdrawDialog.show=!1}}},[e._v("å–æ¶ˆ")]),a("el-button",{attrs:{type:"danger",loading:e.withdrawLoading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleWithdrawConfirm.apply(void 0,arguments)}}},[e._v("ç¡®è®¤æ’¤å›")])]},proxy:!0}]),model:{value:e.withdrawDialog.show,callback:function(t){e.$set(e.withdrawDialog,"show",t)},expression:"withdrawDialog.show"}},[a("v-uni-view",{staticClass:"withdraw-dialog-content"},[a("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"warning",closable:!1}},[e._v(" æ’¤å›ç”³è¯·åï¼Œå°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼ ")]),a("el-form",{ref:"withdrawFormRef",attrs:{model:e.withdrawForm,rules:e.withdrawRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"æ’¤å›åŸå› ",prop:"reason",required:!0}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"è¯·è¯´æ˜æ’¤å›ç”³è¯·çš„åŸå› ",maxlength:"500","show-word-limit":!0},model:{value:e.withdrawForm.reason,callback:function(t){e.$set(e.withdrawForm,"reason",t)},expression:"withdrawForm.reason"}})],1)],1)],1)],1),a("dynamic-form-dialog",{attrs:{title:e.dynamicFormDialog.title,butVisible:!1,"form-schema":e.dynamicFormDialog.formSchema,"form-type-code":e.dynamicFormDialog.formTypeCode,saveLoading:e.saveFormLoading,"initial-data":e.dynamicFormDialog.data},on:{save:function(t){arguments[0]=t=e.$handleEvent(t),e.handleDynamicFormSave.apply(void 0,arguments)},cancel:function(t){arguments[0]=t=e.$handleEvent(t),e.handleDynamicFormCancel.apply(void 0,arguments)},"preview-file":function(t){arguments[0]=t=e.$handleEvent(t),e.previewFile.apply(void 0,arguments)}},model:{value:e.dynamicFormDialog.show,callback:function(t){e.$set(e.dynamicFormDialog,"show",t)},expression:"dynamicFormDialog.show"}}),a("file-preview-dialog",{attrs:{"file-data":e.filePreview.data},on:{download:function(t){arguments[0]=t=e.$handleEvent(t),e.downloadFile.apply(void 0,arguments)}},model:{value:e.filePreview.show,callback:function(t){e.$set(e.filePreview,"show",t)},expression:"filePreview.show"}})],1)},o=[]},c293:function(e,t,a){"use strict";a.r(t);var n=a("ba67"),r=a("5a70");for(var o in r)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(o);a("9632");var i=a("828b"),l=Object(i["a"])(r["default"],n["b"],n["c"],!1,null,"6c85cc0f",null,!1,n["a"],void 0);t["default"]=l.exports}}]);