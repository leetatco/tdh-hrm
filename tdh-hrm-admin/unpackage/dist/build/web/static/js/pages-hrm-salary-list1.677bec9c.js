(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-hrm-salary-list1"],{"0829":function(e,t,a){"use strict";var n=a("8bdb"),r=a("ea07").entries;n({target:"Object",stat:!0},{entries:function(e){return r(e)}})},"542e":function(e,t,a){var n=a("f470");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=a("967d").default;r("0c7f18d2",n,!0,{sourceMap:!1,shadowMode:!1})},a5dc:function(e,t,a){"use strict";a.r(t);var n=a("e006"),r=a.n(n);for(var l in n)["default"].indexOf(l)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(l);t["default"]=r.a},a6a6:function(e,t,a){"use strict";a.r(t);var n=a("a71d"),r=a("a5dc");for(var l in r)["default"].indexOf(l)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(l);a("d749");var i=a("828b"),s=Object(i["a"])(r["default"],n["b"],n["c"],!1,null,"0a6f7354",null,!1,n["a"],void 0);t["default"]=s.exports},a71d:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"page-body"},[a("vk-data-table-query",{attrs:{columns:e.queryForm1.columns},on:{search:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}},model:{value:e.queryForm1.formData,callback:function(t){e.$set(e.queryForm1,"formData",t)},expression:"queryForm1.formData"}}),a("v-uni-view",[a("el-row",[e.$hasRole("admin")||e.$hasPermission("hrm-salary-export")?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.exportExcelAll.apply(void 0,arguments)}}},[e._v(" 导出全部 ")]):e._e(),e.$hasRole("admin")||e.$hasPermission("hrm-salary-add")?a("el-upload",{staticStyle:{display:"inline-block","margin-left":"20rpx","margin-right":"20rpx"},attrs:{accept:".xlsx, .xls","auto-upload":!1,limit:1,"show-file-list":!1,"on-change":e.handleChange,"file-list":e.fileList,action:""}},[a("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-upload2"}},[e._v("导入excel")])],1):e._e(),e.$hasRole("admin")||e.$hasPermission("hrm-salary-add")?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-tickets"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.exportExcelModel.apply(void 0,arguments)}}},[e._v(" 下载模版 ")]):e._e(),e.table1.multipleSelection&&(e.$hasRole("admin")||e.$hasPermission("hrm-salary-edit"))?a("el-dropdown",{attrs:{"split-button":!1,trigger:"click"},on:{command:function(t){arguments[0]=t=e.$handleEvent(t),e.batchBtn.apply(void 0,arguments)}}},[a("el-button",{staticStyle:{"margin-left":"20rpx"},attrs:{type:"danger",size:"small",disabled:0===e.table1.multipleSelection.length}},[e._v(" 批量审核"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:1}},[e._v("通过")])],1)],1):e._e()],1)],1),a("vk-data-table",{ref:"table1",attrs:{action:e.table1.action,columns:e.table1.columns,"query-form-param":e.queryForm1,"right-btns":e.table1.rightBtns,selection:!0,"row-no":!1,pagination:!0},on:{update:function(t){arguments[0]=t=e.$handleEvent(t),e.updateBtn.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deleteBtn.apply(void 0,arguments)},"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.currentChange.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}}),a("vk-data-dialog",{attrs:{title:e.form1.props.title,width:"800px",mode:"form","close-on-click-modal":!1},model:{value:e.form1.props.show,callback:function(t){e.$set(e.form1.props,"show",t)},expression:"form1.props.show"}},[a("vk-data-form",{attrs:{rules:e.form1.props.rules,action:e.form1.props.action,"form-type":e.form1.props.formType,"before-action":e.form1.props.beforeAction,columns:e.form1.props.columns,"label-width":"110px",inline:!0,columnsNumber:2},on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.form1.props.show=!1,e.refresh()}},model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1)],1)},r=[]},d749:function(e,t,a){"use strict";var n=a("542e"),r=a.n(n);r.a},e006:function(e,t,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("5de6")),l=n(a("b7c7")),i=n(a("2634")),s=n(a("3471")),o=n(a("2fdc"));a("c223"),a("8f71"),a("bf0f"),a("fd3c"),a("f7a5"),a("aa9c"),a("f3f7"),a("18f7"),a("de6c"),a("c1a3"),a("2797"),a("0829"),a("64aa"),a("5c47"),a("af8f");var c=uni.vk,y={},u=new Date(c.pubfn.getOffsetTime(new Date,{mode:"before"})).getFullYear(),d=new Date(c.pubfn.getOffsetTime(new Date,{mode:"before"})).getMonth(),m=d>9?d:"0".concat(d),p=c.myfn.normalizeMonth("".concat(u,"-").concat(m)),f={data:function(){var e=this;return{fileList:[],loading:!1,data:{},table1:{action:"admin/hrm/salary/sys/getList",rightBtns:[{mode:"detail_auto",title:"详细",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-salary-view")}},{mode:"update",title:"编辑",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-salary-edit")}},{mode:"delete",title:"删除",show:function(t){return e.$hasRole("admin")||e.$hasPermission("hrm-salary-delete")}}],columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",fixed:!0,valueFormat:"yyyy-MM",format:"yyyy-MM"},{key:"total_salary",title:"综合",type:"number",fixed:!0,width:100},{key:"rest_type",title:"制",fixed:!0,type:"text",width:100},{key:"attendance_ym_key",title:"月份",type:"text",fixed:!0,width:100},{key:"employee_name",title:"姓名",type:"text",fixed:!0,width:100},{key:"card",title:"身份证号码",type:"text",fixed:!0,width:170},{key:"department_name",title:"部门",fixed:!0,type:"text",width:200},{key:"position_name",title:"岗位",type:"text",width:100},{key:"hire_date",title:"入职日期",type:"date",dateType:"date",valueFormat:"yyyy-MM-dd",width:100},{key:"resign_date",title:"离职日期",type:"text",width:100},{key:"base_salary",title:"基本工资",type:"number",width:100},{key:"performance_salary",title:"绩效工资",type:"number",width:100},{key:"overtime_fee",title:"固定加班",type:"number",width:100},{key:"penalty_fund",title:"社保补偿金",type:"number",width:100},{key:"housing_fund",title:"公积补偿金",type:"number",width:100},{key:"annual_allowance",title:"年度补偿金",type:"number",width:100},{key:"floating_bonus",title:"浮动奖励",type:"number",width:100},{key:"confidentiality_fee",title:"保密费",type:"number",width:100},{key:"work_days",title:"应勤天数",type:"number",width:100},{key:"real_days",title:"实际出勤",type:"number",width:100},{key:"gross_salary",title:"应发工资",type:"number",width:100},{key:"overtime_cost",title:"加班费",type:"text",width:100},{key:"free_cost",title:"放假补助",type:"number",width:100},{key:"grant",title:"补助",type:"number",width:100},{key:"agency_fee",title:"介绍费",type:"text",width:100},{key:"other_cost",title:"其它",type:"text",width:100},{key:"we_cost",title:"水电",type:"number",width:100},{key:"clothes_cost",title:"工衣",type:"number",width:100},{key:"earlytime_cost",title:"迟到早退",type:"number",width:100},{key:"missed_cost",title:"未打卡",type:"number",width:100},{key:"loan_cost",title:"借款",type:"number",width:100},{key:"this_month_sb",title:"本月社保",type:"number",width:100},{key:"this_month_dk",title:"本月代扣部份",type:"number",width:100},{key:"dkgs",title:"代扣个税",type:"number",width:100},{key:"real_salary",title:"实发工资",type:"number",width:100},{key:"comment",title:"备注",type:"text",width:200,show:["detail"]},{key:"company_sb",title:"公司部份社保",type:"number",width:100},{key:"company_gjj",title:"公司部份公积金",type:"number",width:100},{key:"last_month_sb",title:"下月社保",type:"number",width:100},{key:"last_month_gjj",title:"下月公积金",type:"number",width:100},{key:"enable_fd1",title:"财务审核一级",type:"switch",activeValue:!0,inactiveValue:!1,width:150,watch:function(t){var a=t.value,n=t.row;t.change;c.callFunction({url:"admin/hrm/salary/sys/update",title:a?"通过中...":"未通过中...",data:{_id:n._id,attendance_ym_key:n.attendance_ym_key,card:n.card,enable_fd1:a},success:function(t){e.refresh()}})}},{key:"update_date",title:"更新时间",type:"time",width:200,show:["detail"]},{key:"users.nickname",title:"更新人",type:"text",width:200,show:["detail"]}],multipleSelection:[],selectItem:""},queryForm1:{formData:{attendance_ym:p,enable_fd1:!1},columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",valueFormat:"yyyy-MM",format:"yyyy-MM",width:200},{key:"card",title:"",type:"table-select",placeholder:"选择员工",action:"admin/hrm/salary/sys/getList",multiple:!1,columns:[{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0},{key:"card",title:"身份证号码",type:"text",idKey:!0}],queryColumns:[{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"card",title:"身份证号码",type:"text",width:150,mode:"%%"}]},{key:"enable_fd1",title:"财务审核一级",type:"select",show:["none"],data:[{value:!0,label:"已通过"},{value:!1,label:"未通过"}],mode:"="},{key:"enable_fd2",title:"财务审核二级",type:"select",show:["none"],data:[{value:!0,label:"已通过"},{value:!1,label:"未通过"}],mode:"="}]},form1:{data:{beforeAction:function(t){return t=e.calculateSalary(t),t}},props:{action:"",columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",disabled:!0,valueFormat:"yyyy-MM",format:"yyyy-MM",width:200},{key:"card",title:"姓名",type:"table-select",disabled:!0,placeholder:"选择员工",action:"admin/hrm/salary/sys/getList",multiple:!1,columns:[{key:"employee_name",title:"员工姓名",type:"text",nameKey:!0},{key:"card",title:"身份证号码",type:"text",idKey:!0}],queryColumns:[{key:"employee_name",title:"员工姓名",type:"text",width:150,mode:"%%"},{key:"card",title:"身份证号码",type:"text",width:150,mode:"%%"}]},{key:"total_salary",title:"综合",type:"number",disabled:!0,width:200},{key:"rest_type",title:"休息类型",type:"text",disabled:!0,width:200},{key:"base_salary",title:"基本工资",type:"number",disabled:!0,width:200},{key:"performance_salary",title:"绩效工资",disabled:!0,type:"number",width:200},{key:"overtime_fee",title:"固定加班",type:"number",disabled:!0,width:200},{key:"penalty_fund",title:"社保补偿金",disabled:!0,type:"number",width:200},{key:"housing_fund",title:"公积补偿金",disabled:!0,type:"number",width:200},{key:"annual_allowance",title:"年度补偿金",disabled:!0,type:"number",width:200},{key:"floating_bonus",title:"浮动奖励",disabled:!0,type:"number",width:200},{key:"confidentiality_fee",title:"保密费",disabled:!0,type:"number",width:200},{key:"work_days",title:"应勤天数",disabled:!0,type:"number",width:200},{key:"real_days",title:"实际出勤",disabled:!0,type:"number",width:200},{key:"gross_salary",title:"应发工资",disabled:!0,type:"number",width:200},{key:"overtime_cost",title:"加班费",type:"text",width:200},{key:"free_cost",title:"放假补助",type:"number",width:200},{key:"grant",title:"补助",type:"number",width:200},{key:"agency_fee",title:"介绍费",type:"text",width:200},{key:"other_cost",title:"其它",type:"text",width:200},{key:"we_cost",title:"水电",type:"number",width:200},{key:"clothes_cost",title:"工衣",type:"number",width:200},{key:"earlytime_cost",title:"迟到早退",type:"number",width:200},{key:"missed_cost",title:"未打卡",type:"number",width:200},{key:"loan_cost",title:"借款",type:"number",width:200},{key:"this_month_sb",title:"本月社保",type:"number",width:200},{key:"this_month_dk",title:"本月代扣部份",type:"number",width:200},{key:"dkgs",title:"代扣个税",type:"number",width:200},{key:"real_salary",title:"实发工资",type:"number",disabled:!0,width:200},{key:"company_sb",title:"公司部份社保",type:"number",width:200},{key:"company_gjj",title:"公司部份公积金",type:"number",width:200},{key:"last_month_sb",title:"下月社保",type:"number",width:200},{key:"last_month_gjj",title:"下月公积金",type:"number",width:200},{key:"comment",title:"备注",type:"textarea",maxlength:"500",showWordLimit:!0,width:200,autosize:{minRows:4,maxRows:10}},{key:"enable_fd1",title:"财务审核一级",type:"switch",width:200}],rules:{attendance_ym:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}],employee_name:[{required:!0,message:"该项不能为空",trigger:["blur","change"]}]},formType:"",title:"",show:!1}},formDatas:{}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c=this.vk,this.options=e,this.init(e)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{handleChange:function(e){var t=this;return(0,o.default)((0,i.default)().mark((function a(){var n;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n={total_salary:{title:"综合",type:"number"},rest_type:{title:"制",type:"text"},attendance_ym_key:{title:"月份",type:"text"},employee_name:{title:"姓名",type:"text"},card:{title:"身份证号码",type:"text"},department_name:{title:"任职部门",type:"text"},position_name:{title:"岗位",type:"text"},hire_date:{title:"入职日期",type:"number"},resign_date:{title:"离职日期",type:"text"},base_salary:{title:"基本工资",type:"number"},performance_salary:{title:"绩效工资",type:"number"},overtime_fee:{title:"固定加班",type:"number"},penalty_fund:{title:"社保补偿金",type:"number"},housing_fund:{title:"公积补偿金",type:"number"},annual_allowance:{title:"年度补偿金",type:"number"},floating_bonus:{title:"浮动奖励",type:"number"},confidentiality_fee:{title:"保密费",type:"number"},work_days:{title:"应勤天数",type:"number"},real_days:{title:"实际出勤",type:"number"},gross_salary:{title:"应发工资",type:"number"},overtime_cost:{title:"加班费",type:"text"},free_cost:{title:"放假补助",type:"number"},grant:{title:"补助",type:"number"},agency_fee:{title:"介绍费",type:"number"},other_cost:{title:"其它",type:"number"},we_cost:{title:"水电",type:"number"},clothes_cost:{title:"工衣",type:"number"},earlytime_cost:{title:"迟到早退",type:"number"},missed_cost:{title:"未打卡",type:"number"},loan_cost:{title:"借款",type:"number"},this_month_sb:{title:"本月社保",type:"number"},this_month_dk:{title:"本月代扣部份",type:"number"},dkgs:{title:"代扣个税",type:"number"},real_salary:{title:"实发工资",type:"number"},comment:{title:"备注",type:"text"},company_sb:{title:"公司部份社保",type:"number"},company_gjj:{title:"公司部份公积金",type:"number"},last_month_sb:{title:"下月社保",type:"number"},last_month_dk:{title:"下月公积金",type:"number"}};try{t.$iexcel.importExcel(e.raw,n,function(){var e=(0,o.default)((0,i.default)().mark((function e(a){var n,r,l,o,y,u,d,m,f,h,_,b,k;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a&&0!==a.length){e.next=2;break}return e.abrupt("return",c.alert("Excel中没有数据！"));case 2:return e.next=4,c.callFunction({url:"admin/hrm/salary/sys/all/deleteAll",title:"删除中...",data:{attendance_ym:p}});case 4:if(n=e.sent,0==n.code){e.next=7;break}return e.abrupt("return",c.alert("".concat(p,"月工资表明细删除失败！")));case 7:if(r=t.validateExcelData(a),r.valid){e.next=10;break}return e.abrupt("return",c.alert(r.message,"数据验证失败","确定"));case 10:if(l=a.map((function(e){return e.card})).filter((function(e){return e})),0!==l.length){e.next=13;break}return e.abrupt("return",c.alert("Excel中没有有效的身份证号码！"));case 13:o=[],y=[],u=(0,s.default)(a),e.prev=16,u.s();case 18:if((d=u.n()).done){e.next=41;break}if(m=d.value,m.attendance_ym=p,m.attendance_ym){e.next=24;break}return y.push({item:m,reason:"考勤日期不能为空"}),e.abrupt("continue",39);case 24:if(m.card){e.next=27;break}return y.push({item:m,reason:"身份证号码不能为空"}),e.abrupt("continue",39);case 27:if(f=c.pubfn.copyObject(m),f=t.calculateSalary(f),f.gross_salary===m.gross_salary&&f.real_salary===m.real_salary){e.next=32;break}return y.push({item:m,reason:"应发工资:".concat(f.gross_salary,"=").concat(m.gross_salary,",实发工资:").concat(f.real_salary,"=").concat(m.real_salary)}),e.abrupt("continue",39);case 32:m.enable_fd1=!1,m.enable_fd2=!1,m.update_date=(new Date).getTime(),m.update_id=c.getVuex("$user.userInfo._id"),h=new Date(Date.UTC(1900,0,m.hire_date-1)),m.hire_date=h.toISOString().slice(0,10),o.push(m);case 39:e.next=18;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e["catch"](16),u.e(e.t0);case 46:return e.prev=46,u.f(),e.finish(46);case 49:if(!(y.length>0)){e.next=53;break}return _=y.slice(0,5).map((function(e){return"姓名: ".concat(e.item.employee_name," - ").concat(e.reason)})).join("\n"),y.length>5&&(_+="\n...还有".concat(y.length-5,"条错误数据")),e.abrupt("return",c.alert("所有数据验证失败:\n".concat(_),"导入失败","确定"));case 53:return c.toast("开始导入数据..."),e.next=56,c.callFunction({url:"admin/hrm/salary/sys/all/addAll",title:"请求中...",data:{items:o}});case 56:b=e.sent,0===b.code?(k="导入完成！成功: ".concat(b.id.length,"条"),c.alert(k,"导入成功","确定",(function(){t.refresh()}))):c.alert("导入Excel失败!","系统错误","确定");case 58:case"end":return e.stop()}}),e,null,[[16,43,46,49]])})));return function(t){return e.apply(this,arguments)}}())}catch(r){console.error("导入Excel失败:",r),c.alert("导入Excel失败: ".concat(r.message),"系统错误","确定"),t.fileList=[]}case 2:case"end":return a.stop()}}),a)})))()},validateExcelData:function(e){if(!Array.isArray(e))return{valid:!1,message:"数据格式错误"};var t,a=new Set,n=[],r=(0,s.default)(e);try{for(r.s();!(t=r.n()).done;){var l=t.value;if(l.card&&l.attendance_ym){var i="".concat(l.card,"_").concat(l.attendance_ym);a.has(i)&&n.push(l.card),a.add(i)}}}catch(o){r.e(o)}finally{r.f()}return n.length>0?{valid:!1,message:"存在重复数据: ".concat(n.slice(0,5).join(", ")).concat(n.length>5?"...":"")}:{valid:!0,message:""}},autoSalary:function(){var e=this;return(0,o.default)((0,i.default)().mark((function t(){return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{c.confirm("确定将删除".concat(p,"月全部数据，重新生成工资表！"),"提示","确定","取消",function(){var t=(0,o.default)((0,i.default)().mark((function t(a){var n,y,u,d,m,f,h,_,b,k,w,v,x,g,$,F,S,E,M,j,D,T;return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a.confirm){t.next=74;break}return c.toast("开始生成工资表..."),t.next=4,c.callFunction({url:"admin/hrm/salary/pub/getAproveList",title:"请求中...",data:{attendance_ym:p,enable_hr:!0}});case 4:if(n=t.sent,0!=n.total){t.next=7;break}return t.abrupt("return",c.alert("没有".concat(p,"月考勤数据，请联系人事考勤！")));case 7:return t.next=9,c.callFunction({url:"admin/hrm/salary/sys/all/deleteAll",title:"删除中...",data:{attendance_ym:p}});case 9:if(y=t.sent,0==y.code){t.next=12;break}return t.abrupt("return",c.alert("".concat(p,"月工资表明细删除失败！")));case 12:return u=n.rows.map((function(e){return e.employee_id})),d=(0,l.default)(new Set(n.rows.map((function(e){return e.attendance_ym_key})))),m=(0,l.default)(new Set(n.rows.map((function(e){return e.salarys.salary})))),c.toast("批量获取相关数据..."),t.next=18,Promise.all([e.batchGetSalaryRules(m),e.batchGetFreeData(u,d),e.batchGetGsData(u,d),e.batchGetSbData(u,d),e.batchGetCompanySbData(u,d)]);case 18:f=t.sent,h=(0,r.default)(f,5),_=h[0],b=h[1],k=h[2],w=h[3],v=h[4],x=[],g=[],$=(0,s.default)(n.rows),t.prev=28,$.s();case 30:if((F=$.n()).done){t.next=58;break}if(S=F.value,t.prev=32,!c.pubfn.isNull(S.salarys)&&!c.pubfn.isNull(S.salarys.salary)){t.next=36;break}return g.push("员工姓名：".concat(S.employees.employee_name,"/").concat(S.employees.employee_id,", 没有定薪数据！")),t.abrupt("continue",56);case 36:if(E=_.get(S.salarys.salary),E||1!=S.salarys.salary_type){t.next=40;break}return g.push("综合：".concat(S.salarys.salary,", 基本资料：工号-").concat(S.employees.employee_id,"/月薪, 没有薪资分配表数据！")),t.abrupt("continue",56);case 40:1==S.salarys.salary_type&&E&&(S.salarys.salary!==E.total_salary&&(E.performance_salary-=E.total_salary-S.salarys.salary),S.bases=E),M="".concat(S.employee_id,"_").concat(S.attendance_ym_key),S.frees=b.get(M)||{},S.gss=k.get(M)||{},S.sbs=w.get(M)||{},S.companysbs=v.get(M)||{},S.update_date=(new Date).getTime(),S.update_id=c.getVuex("$user.userInfo._id"),S=e.setSalaryFields(S),S=e.calculateSalary(S),x.push(S),t.next=56;break;case 53:t.prev=53,t.t0=t["catch"](32),g.push("处理员工 ".concat((null===(j=S.employees)||void 0===j?void 0:j.employee_name)||S.employee_id," 失败: ").concat(t.t0.message));case 56:t.next=30;break;case 58:t.next=63;break;case 60:t.prev=60,t.t1=t["catch"](28),$.e(t.t1);case 63:return t.prev=63,$.f(),t.finish(63);case 66:if(!(g.length>0)){t.next=72;break}D=g.slice(0,5).join("\n"),T=g.length>5?"\n...还有".concat(g.length-5,"条错误"):"",c.confirm("发现".concat(g.length,"个错误：\n").concat(D).concat(T,"\n\n是否继续处理有效数据？"),"处理警告","继续","取消",function(){var t=(0,o.default)((0,i.default)().mark((function t(a){return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a.confirm){t.next=3;break}return t.next=3,e.saveSalaryData(x);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=74;break;case 72:return t.next=74,e.saveSalaryData(x);case 74:case"end":return t.stop()}}),t,null,[[28,60,63,66],[32,53]])})));return function(e){return t.apply(this,arguments)}}())}catch(a){console.error("处理过程中发生错误:",a),c.alert("处理过程中发生错误: ".concat(a.message),"系统错误","确定")}case 1:case"end":return t.stop()}}),t)})))()},batchGetSalaryRules:function(e){return(0,o.default)((0,i.default)().mark((function t(){var a,n;return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new Map,t.prev=1,t.next=4,c.callFunction({url:"admin/hrm/salary/pub/getBaseSalary",title:"获取薪资规则中...",data:{total_salaries:e,match_type:"range"}});case 4:n=t.sent,0===n.code&&n.data&&Object.entries(n.data).forEach((function(e){var t=(0,r.default)(e,2),n=t[0],l=t[1];a.set(Number(n),l)})),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.error("批量获取薪资规则失败:",t.t0);case 11:return t.abrupt("return",a);case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()},batchGetFreeData:function(e,t){return(0,o.default)((0,i.default)().mark((function a(){var n,r;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Map,a.prev=1,a.next=4,c.callFunction({url:"admin/hrm/salary/sys/all/getfreeAll",title:"获取放假补助中...",data:{employee_ids:e,attendance_ym_keys:t}});case 4:r=a.sent,0===r.code&&r.rows&&r.rows.forEach((function(e){var t="".concat(e.employee_id,"_").concat(e.attendance_ym);n.set(t,e)})),a.next=11;break;case 8:a.prev=8,a.t0=a["catch"](1),console.error("批量获取放假补助失败:",a.t0);case 11:return a.abrupt("return",n);case 12:case"end":return a.stop()}}),a,null,[[1,8]])})))()},batchGetGsData:function(e,t){return(0,o.default)((0,i.default)().mark((function a(){var n,r;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Map,a.prev=1,a.next=4,c.callFunction({url:"admin/hrm/salary/sys/all/getgsAll",title:"获取个税数据中...",data:{employee_ids:e,attendance_ym_keys:t}});case 4:r=a.sent,0===r.code&&r.rows&&r.rows.forEach((function(e){var t="".concat(e.employee_id,"_").concat(e.attendance_ym);n.set(t,e)})),a.next=11;break;case 8:a.prev=8,a.t0=a["catch"](1),console.error("批量获取个税数据失败:",a.t0);case 11:return a.abrupt("return",n);case 12:case"end":return a.stop()}}),a,null,[[1,8]])})))()},batchGetSbData:function(e,t){return(0,o.default)((0,i.default)().mark((function a(){var n,r;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Map,a.prev=1,a.next=4,c.callFunction({url:"admin/hrm/salary/sys/all/getsbdkAll",title:"获取个人社保中...",data:{employee_ids:e,attendance_ym_keys:t}});case 4:r=a.sent,0===r.code&&r.rows&&r.rows.forEach((function(e){var t="".concat(e.employee_id,"_").concat(e.attendance_ym);n.set(t,e)})),a.next=11;break;case 8:a.prev=8,a.t0=a["catch"](1),console.error("批量获取个人社保失败:",a.t0);case 11:return a.abrupt("return",n);case 12:case"end":return a.stop()}}),a,null,[[1,8]])})))()},batchGetCompanySbData:function(e,t){return(0,o.default)((0,i.default)().mark((function a(){var n,r;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Map,a.prev=1,a.next=4,c.callFunction({url:"admin/hrm/salary/sys/all/getcomsbAll",title:"获取公司社保中...",data:{employee_ids:e,attendance_ym_keys:t}});case 4:r=a.sent,0===r.code&&r.rows&&r.rows.forEach((function(e){var t="".concat(e.employee_id,"_").concat(e.attendance_ym);n.set(t,e)})),a.next=11;break;case 8:a.prev=8,a.t0=a["catch"](1),console.error("批量获取公司社保失败:",a.t0);case 11:return a.abrupt("return",n);case 12:case"end":return a.stop()}}),a,null,[[1,8]])})))()},setSalaryFields:function(e){e.total_salary=e.salarys?e.salarys.salary:0,e.rest_type=e.employees?e.employees.rest_type:"",e.salary_type=e.salarys?e.salarys.salary_type:"",e.base_salary=e.bases?e.bases.base_salary:0,e.performance_salary=e.bases?e.bases.performance_salary:0,e.overtime_fee=e.bases?e.bases.overtime_fee:0,e.housing_fund=e.bases?e.bases.housing_fund:0,e.annual_allowance=e.bases?e.bases.annual_allowance:0,e.floating_bonus=e.bases?e.bases.floating_bonus:0,e.confidentiality_fee=e.bases?e.bases.confidentiality_fee:0,e.free_cost=e.frees?e.frees.amount:0,e.agency_fee=e.agency_fee||0;var t=e.reward_cost||0,a=e.punish_cost||0,n=e.other_cost||0;return e.other_cost=t+n-a,e.we_cost=e.share_cost||0,e.clothes_cost=e.clothes_cost||0,e.last_month_sb=e.sbs?e.sbs.last_month_sb:0,e.last_month_dk=e.sbs?e.sbs.last_month_dk:0,e.this_month_sb=e.sbs?e.sbs.this_month_sb:0,e.this_month_dk=e.sbs?e.sbs.this_month_dk:0,e.dkgs=e.gss?e.gss.gs:0,e.company_sb=e.companysbs?e.companysbs.amount:0,e.company_gjj=e.companysbs?e.companysbs.provident_fund:0,e},calculateSalary:function(e){var t=0;t+=e.base_salary,t+=e.performance_salary||0,t+=e.overtime_fee||0,t+=e.penalty_fund||0,t+=e.housing_fund||0,t+=e.annual_allowance||0,t+=e.floating_bonus||0,t+=e.confidentiality_fee||0;var a=t/e.work_days*e.real_days;e.gross_salary=c.pubfn.toDecimal(a,2);var n=e.gross_salary||0;return n+=e.overtime_cost||0,n+=e.free_cost||0,n+=e.grant||0,n+=e.agency_fee||0,n+=e.other_cost||0,n-=e.we_cost||0,n-=e.clothes_cost||0,n-=e.earlytime_cost||0,n-=e.missed_cost||0,n-=e.loan_cost||0,n-=e.this_month_sb||0,n-=e.this_month_dk||0,n-=e.dkgs||0,e.real_salary=c.pubfn.toDecimal(n,2),e},saveSalaryData:function(e){var t=this;return(0,o.default)((0,i.default)().mark((function a(){var n,r,l;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(0!==e.length){a.next=2;break}return a.abrupt("return",c.alert("没有有效数据需要保存！"));case 2:return a.prev=2,c.toast("保存工资表中..."),a.next=6,c.callFunction({url:"admin/hrm/salary/sys/all/addAll",title:"请求中...",data:{items:e}});case 6:n=a.sent,0===n.code?(l="新增工资表完成！成功: ".concat((null===(r=n.id)||void 0===r?void 0:r.length)||e.length,"条"),c.alert(l,"新增成功","确定",(function(){t.refresh()}))):c.alert("新增失败: ".concat(n.msg||"未知错误"),"系统错误","确定"),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](2),console.error("保存工资表失败:",a.t0),c.alert("保存工资表失败: ".concat(a.t0.message),"系统错误","确定");case 14:case"end":return a.stop()}}),a,null,[[2,10]])})))()},init:function(e){y["form1"]=c.pubfn.copyObject(this.form1)},pageTo:function(e){c.navigateTo(e)},resetForm:function(){c.pubfn.resetForm(y,this)},search:function(){this.$refs.table1.search()},refresh:function(){this.$refs.table1.refresh()},getCurrentRow:function(){return this.$refs.table1.getCurrentRow()},currentChange:function(e){this.table1.selectItem=e},selectionChange:function(e){this.table1.multipleSelection=e},addBtn:function(){this.resetForm(),this.form1.props.action="admin/hrm/salary/sys/add",this.form1.props.formType="add",this.form1.props.title="添加",this.form1.props.show=!0},updateBtn:function(e){var t=e.item;this.form1.props.action="admin/hrm/salary/sys/update",this.form1.props.formType="update",this.form1.props.title="编辑",this.form1.props.show=!0,this.form1.data=t},deleteBtn:function(e){var t=e.item,a=e.deleteFn;a({action:"admin/hrm/salary/sys/delete",data:{_id:t._id}})},batchBtn:function(e){var t=this;switch(e){case 1:this.table1.multipleSelection.forEach(function(){var e=(0,o.default)((0,i.default)().mark((function e(a){var n;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.callFunction({url:"admin/hrm/salary/sys/update",title:"请求中...",data:{_id:a._id,card:a.card,attendance_ym_key:a.attendance_ym_key,enable_fd1:!0}});case 2:n=e.sent,0==n.code&&c.alert("批量审核通过成功","确定",(function(){t.refresh()}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());break;case 2:this.table1.multipleSelection.forEach(function(){var e=(0,o.default)((0,i.default)().mark((function e(a){var n;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.callFunction({url:"admin/hrm/salary/sys/update",title:"请求中...",data:{_id:a._id,card:a.card,attendance_ym_key:a.attendance_ym_key,enable_fd1:!1}});case 2:n=e.sent,0==n.code&&c.alert("批量审核未通过成功","确定",(function(){t.refresh()}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());break;default:break}},exportExcelModel:function(){this.$refs.table1.exportExcel({fileName:(new Date).getFullYear()+"考勤明细模版",title:"正在导出数据...",columns:[{key:"total_salary",title:"综合",type:"number"},{key:"rest_type",title:"制",type:"text"},{key:"attendance_ym",title:"月份",type:"text"},{key:"employee_name",title:"姓名",type:"text"},{key:"card",title:"身份证号码",type:"text"},{key:"department_name",title:"任职部门",type:"text"},{key:"position_name",title:"岗位",type:"text"},{key:"hire_date",title:"入职日期",type:"number"},{key:"resign_date",title:"离职日期",type:"text"},{key:"base_salary",title:"基本工资",type:"number"},{key:"performance_salary",title:"绩效工资",type:"number"},{key:"overtime_fee",title:"固定加班",type:"number"},{key:"penalty_fund",title:"社保补偿金",type:"number"},{key:"housing_fund",title:"公积补偿金",type:"number"},{key:"annual_allowance",title:"年度补偿金",type:"number"},{key:"floating_bonus",title:"浮动奖励",type:"number"},{key:"confidentiality_fee",title:"保密费",type:"number"},{key:"work_days",title:"应勤天数",type:"number"},{key:"real_days",title:"实际出勤",type:"number"},{key:"gross_salary",title:"应发工资",type:"number"},{key:"overtime_cost",title:"加班费",type:"text"},{key:"free_cost",title:"放假补助",type:"number"},{key:"grant",title:"补助",type:"number"},{key:"agency_fee",title:"介绍费",type:"text"},{key:"other_cost",title:"其它",type:"text"},{key:"we_cost",title:"水电",type:"number"},{key:"clothes_cost",title:"工衣",type:"number"},{key:"earlytime_cost",title:"迟到早退",type:"number"},{key:"missed_cost",title:"未打卡",type:"number"},{key:"loan_cost",title:"借款",type:"number"},{key:"this_month_sb",title:"本月社保",type:"number"},{key:"this_month_dk",title:"本月代扣部份",type:"number"},{key:"dkgs",title:"代扣个税",type:"number"},{key:"real_salary",title:"实发工资",type:"number"},{key:"comment",title:"备注",type:"text"},{key:"company_sb",title:"公司部份社保",type:"number"},{key:"company_gjj",title:"公司部份公积金",type:"number"},{key:"last_month_sb",title:"下月社保",type:"number"},{key:"last_month_gjj",title:"下月公积金",type:"number"}],pageIndex:1,pageSize:1})},exportExcelAll:function(){this.$refs.table1.exportExcel({fileName:p+"月份工资表",title:"正在导出数据...",columns:[{key:"attendance_ym",title:"考勤日期",type:"date",dateType:"date",fixed:!0,valueFormat:"yyyy-MM",format:"yyyy-MM"},{key:"total_salary",title:"综合",type:"number"},{key:"rest_type",title:"制",type:"text"},{key:"attendance_ym_key",title:"月份",type:"text"},{key:"employee_name",title:"姓名",type:"text"},{key:"card",title:"身份证号码",type:"text"},{key:"department_name",title:"任职部门",type:"text"},{key:"position_name",title:"岗位",type:"text"},{key:"hire_date",title:"入职日期",type:"number"},{key:"resign_date",title:"离职日期",type:"text"},{key:"base_salary",title:"基本工资",type:"number"},{key:"performance_salary",title:"绩效工资",type:"number"},{key:"overtime_fee",title:"固定加班",type:"number"},{key:"penalty_fund",title:"社保补偿金",type:"number"},{key:"housing_fund",title:"公积补偿金",type:"number"},{key:"annual_allowance",title:"年度补偿金",type:"number"},{key:"floating_bonus",title:"浮动奖励",type:"number"},{key:"confidentiality_fee",title:"保密费",type:"number"},{key:"work_days",title:"应勤天数",type:"number"},{key:"real_days",title:"实际出勤",type:"number"},{key:"gross_salary",title:"应发工资",type:"number"},{key:"overtime_cost",title:"加班费",type:"text"},{key:"free_cost",title:"放假补助",type:"number"},{key:"grant",title:"补助",type:"number"},{key:"agency_fee",title:"介绍费",type:"text"},{key:"other_cost",title:"其它",type:"text"},{key:"we_cost",title:"水电",type:"number"},{key:"clothes_cost",title:"工衣",type:"number"},{key:"earlytime_cost",title:"迟到早退",type:"number"},{key:"missed_cost",title:"未打卡",type:"number"},{key:"loan_cost",title:"借款",type:"number"},{key:"this_month_sb",title:"本月社保",type:"number"},{key:"this_month_dk",title:"本月代扣部份",type:"number"},{key:"dkgs",title:"代扣个税",type:"number"},{key:"real_salary",title:"实发工资",type:"number"},{key:"comment",title:"备注",type:"text"},{key:"company_sb",title:"公司部份社保",type:"number"},{key:"company_gjj",title:"公司部份公积金",type:"number"},{key:"last_month_sb",title:"下月社保",type:"number"},{key:"last_month_gjj",title:"下月公积金",type:"number"},{key:"enable_fd1",title:"财务审核一级",type:"text",formatter:function(e,t,a,n){return e?"通过":"未通过"}},{key:"enable_fd2",title:"财务审核二级",type:"text",formatter:function(e,t,a,n){return e?"通过":"未通过"}}],pageIndex:1,pageSize:-1})}},watch:{},computed:{}};t.default=f},f470:function(e,t,a){var n=a("c86c");t=n(!1),t.push([e.i,"",""]),e.exports=t}}]);