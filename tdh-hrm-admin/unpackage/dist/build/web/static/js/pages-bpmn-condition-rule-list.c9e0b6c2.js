(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-bpmn-condition-rule-list"],{"091c":function(e,t,a){"use strict";a.r(t);var o=a("74c7"),n=a.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(i);t["default"]=n.a},"284d":function(e,t,a){var o=a("c86c");t=o(!1),t.push([e.i,".page-body[data-v-d0fa1802]{padding:%?20?%;background:#f5f7fa;min-height:100vh}.button-group[data-v-d0fa1802]{margin-bottom:%?20?%;padding:%?20?% %?24?%;background:#fff;border-radius:%?8?%;-webkit-box-shadow:0 %?2?% %?6?% rgba(0,0,0,.05);box-shadow:0 %?2?% %?6?% rgba(0,0,0,.05);border:%?1?% solid #ebeef5}[data-v-d0fa1802] .condition-rule-dialog .el-dialog__body{padding:0}.dialog-content[data-v-d0fa1802]{padding:24px;max-height:70vh;overflow-y:auto}.condition-form .form-section[data-v-d0fa1802]{margin-bottom:24px;border-radius:8px;border:1px solid #e4e7ed}.condition-form .form-section[data-v-d0fa1802]:last-child{margin-bottom:0}.condition-form .form-section[data-v-d0fa1802]  .el-card__header{padding:16px 20px;background:#f8f9fa;border-bottom:1px solid #e4e7ed}.condition-form .section-header[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.condition-form .section-title[data-v-d0fa1802]{font-size:16px;font-weight:600;color:#303133}.condition-form .section-actions[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.condition-form .form-tip[data-v-d0fa1802]{font-size:12px;color:#909399;margin-top:4px;line-height:1.4}.condition-form .no-margin-form-item[data-v-d0fa1802]{margin-bottom:0}.condition-form .no-margin-form-item[data-v-d0fa1802]  .el-form-item__content{margin-left:0!important}.condition-form .inline-form-item[data-v-d0fa1802]{margin-bottom:0}.condition-form .inline-form-item[data-v-d0fa1802]  .el-form-item__content{line-height:normal}.rule-preview[data-v-d0fa1802]{margin-bottom:16px;padding:12px 16px;background:#f0f9ff;border:1px solid #bee3f8;border-radius:6px}.rule-preview .preview-title[data-v-d0fa1802]{font-weight:600;color:#2b6cb0;margin-bottom:4px}.rule-preview .preview-content[data-v-d0fa1802]{color:#2d3748;font-family:Courier New,monospace;background:#fff;padding:8px 12px;border-radius:4px;border:1px solid #e2e8f0}.conditions-container[data-v-d0fa1802]{padding:0}.condition-list[data-v-d0fa1802]{margin-bottom:16px}.condition-item[data-v-d0fa1802]{margin-bottom:20px}.condition-item[data-v-d0fa1802]:last-child{margin-bottom:0}.condition-header[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:8px;padding:0 4px}.condition-header .condition-index[data-v-d0fa1802]{font-size:14px;font-weight:600;color:#409eff}.condition-content[data-v-d0fa1802]{padding:16px;background:#f8f9fa;border-radius:6px;border:1px solid #e4e7ed}.condition-row[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.condition-actions[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-top:4px}.value-type-tip[data-v-d0fa1802]{margin-top:8px;font-size:12px;color:#909399;padding:4px 8px;background:#edf2f7;border-radius:4px}.condition-connector[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:12px 0;padding:0 20px}.connector-line[data-v-d0fa1802]{-webkit-box-flex:1;-ms-flex:1;flex:1;height:2px;background:#dcdfe6}.connector-text[data-v-d0fa1802]{padding:0 16px}.condition-actions-bottom[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:12px;margin-top:16px}.add-condition-btn[data-v-d0fa1802]{border:1px dashed #dcdfe6;background:#fff;color:#606266}.add-condition-btn[data-v-d0fa1802]:hover{border-color:#409eff;color:#409eff}.field-option .field-name[data-v-d0fa1802]{font-size:14px;color:#303133}.field-option .field-desc[data-v-d0fa1802]{font-size:12px;color:#909399;margin-top:2px}.option-item .option-name[data-v-d0fa1802]{font-size:14px;color:#303133}.option-item .option-code[data-v-d0fa1802]{font-size:12px;color:#909399;margin-top:2px}.scope-disabled-tip[data-v-d0fa1802]{padding:12px 0}.dialog-footer[data-v-d0fa1802]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;gap:12px;padding:16px 24px;border-top:1px solid #e4e7ed;background:#fafafa}.rule-help-content h3[data-v-d0fa1802], .rule-help-content h4[data-v-d0fa1802]{color:#303133;margin-bottom:12px}.rule-help-content ul[data-v-d0fa1802]{padding-left:20px;margin-bottom:16px}.rule-help-content ul li[data-v-d0fa1802]{margin-bottom:8px;line-height:1.5}[data-v-d0fa1802] .vk-data-table .el-table{border-radius:8px;overflow:hidden;-webkit-box-shadow:0 %?2?% %?6?% rgba(0,0,0,.05);box-shadow:0 %?2?% %?6?% rgba(0,0,0,.05)}[data-v-d0fa1802] .vk-data-table .el-table__header th{background-color:#f5f7fa;color:#606266;font-weight:600}@media (max-width:768px){.dialog-content[data-v-d0fa1802]{padding:16px}.condition-form .form-section[data-v-d0fa1802]{margin-bottom:16px}.condition-content[data-v-d0fa1802]{padding:12px}.condition-row[data-v-d0fa1802]{-ms-flex-wrap:wrap;flex-wrap:wrap}.condition-row .el-col[data-v-d0fa1802]{margin-bottom:8px}}",""]),e.exports=t},"74c7":function(e,t,a){"use strict";a("6a54");var o=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(a("9b1b")),i=o(a("3471")),l=o(a("2634")),r=o(a("2fdc"));a("fd3c"),a("c223"),a("7a76"),a("c9b5"),a("bf0f"),a("aa9c"),a("dd2b"),a("aa77"),a("4626"),a("5c47"),a("af8f");var s=uni.vk,d={},c={components:{ValueInput:{props:["value","placeholder","options","multiple"],render:function(e){var t=this;return this.options&&this.options.length>0?e("el-select",{props:{value:this.value,placeholder:this.placeholder,multiple:this.multiple,filterable:!0,clearable:!0},on:{input:function(e){return t.$emit("input",e)}}},this.options.map((function(t){return e("el-option",{props:{label:t.label,value:t.value}})}))):e("el-input",{props:{value:this.value,placeholder:this.placeholder,clearable:!0},on:{input:function(e){return t.$emit("input",e)}}})}}},data:function(){var e=this;return{loading:!1,formLoading:!1,ruleHelpVisible:!1,enableScope:!0,fieldRules:[{required:!0,message:"请选择字段",trigger:"change"}],operatorRules:[{required:!0,message:"请选择操作符",trigger:"change"}],valueRules:[{required:!0,message:"请输入值",trigger:"change"}],valueTypeRules:[{required:!0,message:"请选择值类型",trigger:"change"}],fieldGroups:[{label:"用印相关字段",options:[{value:"seal_type",label:"用印类型",description:"印章类型",type:"select"},{value:"file_type",label:"文件类型",description:"文件分类",type:"select"},{value:"copies",label:"用印份数",description:"盖章数量",type:"number"},{value:"urgency_level",label:"紧急程度",description:"紧急级别",type:"select"},{value:"amount",label:"涉及金额",description:"金额数值",type:"number"}]},{label:"申请人信息",options:[{value:"department_code",label:"部门编码",description:"申请人部门",type:"string"},{value:"position_level",label:"职位级别",description:"职级",type:"number"},{value:"employee_level",label:"员工级别",description:"员工等级",type:"number"},{value:"work_years",label:"工作年限",description:"司龄",type:"number"}]},{label:"系统字段",options:[{value:"_add_time",label:"创建时间",description:"申请时间",type:"date"},{value:"applicant_role",label:"申请人角色",description:"用户角色",type:"select"}]}],operators:{string:[{value:"eq",label:"等于"},{value:"ne",label:"不等于"},{value:"contains",label:"包含"},{value:"not_contains",label:"不包含"},{value:"regex",label:"正则匹配"}],number:[{value:"eq",label:"等于"},{value:"ne",label:"不等于"},{value:"gt",label:"大于"},{value:"gte",label:"大于等于"},{value:"lt",label:"小于"},{value:"lte",label:"小于等于"},{value:"between",label:"介于之间",disabled:!0}],select:[{value:"eq",label:"等于"},{value:"ne",label:"不等于"},{value:"in",label:"包含任一"},{value:"not_in",label:"不包含任一"}],date:[{value:"eq",label:"等于"},{value:"ne",label:"不等于"},{value:"gt",label:"晚于"},{value:"gte",label:"晚于或等于"},{value:"lt",label:"早于"},{value:"lte",label:"早于或等于"}]},valueTypes:[{value:"constant",label:"常量"},{value:"variable",label:"变量"},{value:"expression",label:"表达式"}],fieldOptions:{seal_type:[{value:"company_seal",label:"公司公章"},{value:"contract_seal",label:"合同专用章"},{value:"finance_seal",label:"财务专用章"},{value:"legal_seal",label:"法人章"},{value:"hr_seal",label:"人事专用章"}],file_type:[{value:"contract",label:"合同/协议"},{value:"certificate",label:"证明文件"},{value:"application",label:"申请文件"},{value:"report",label:"报告文件"},{value:"other",label:"其他文件"}],urgency_level:[{value:"normal",label:"普通"},{value:"urgent",label:"紧急"},{value:"very_urgent",label:"特急"}],applicant_role:[{value:"employee",label:"普通员工"},{value:"manager",label:"部门经理"},{value:"director",label:"总监"},{value:"admin",label:"管理员"}]},operatorHelpData:[{operator:"eq",description:"等于",example:'部门 = "技术部"'},{operator:"ne",description:"不等于",example:'部门 ≠ "人事部"'},{operator:"gt",description:"大于",example:"金额 > 1000"},{operator:"gte",description:"大于等于",example:"金额 ≥ 5000"},{operator:"lt",description:"小于",example:"天数 < 30"},{operator:"lte",description:"小于等于",example:"级别 ≤ 3"},{operator:"contains",description:"包含文本",example:'事由包含 "紧急"'},{operator:"in",description:"包含任一",example:'类型 in ["公章", "合同章"]'},{operator:"not_in",description:"不包含任一",example:'部门 not_in ["财务部"]'}],formTypes:[],departments:[],table1:{action:"admin/bpmn/condition-rule/sys/getList",rightBtns:[{title:"详细",mode:"detail_auto",show:function(t){return e.$hasRole("admin")||e.$hasPermission("bpmn-workflow-view")},onClick:function(t){return e.showDetail(t)}},{title:"编辑",mode:"update",show:function(t){return e.$hasRole("admin")||e.$hasPermission("bpmn-workflow-edit")},onClick:function(t){return e.updateBtn({item:t})}},{title:"删除",mode:"delete",show:function(t){return e.$hasRole("admin")||e.$hasPermission("bpmn-workflow-delete")},onClick:function(t){return e.deleteBtn({item:t})}},{title:"测试",type:"success",show:function(t){return e.$hasRole("admin")||$hasPermission("bpmn-workflow-edit")},onClick:function(t){return e.testRule(t)}}],columns:[{key:"code",title:"规则编码",type:"text",width:250,fixed:"left"},{key:"name",title:"规则名称",type:"text",width:200},{key:"rule_expression",title:"条件配置",type:"text",width:200,render:function(e){if(!e||!e.conditions)return"-";var t=e.conditions.length,a=(e.type,"and"===e.logic?"且":"或");return"".concat(t,"条件").concat("composite"===e.type?" (".concat(a,")"):"")}},{key:"scope",title:"适用范围",type:"text",width:200,render:function(e){if(!e)return"全部";var t=e.form_types?e.form_types.length:0,a=e.departments?e.departments.length:0;return 0===t&&0===a?"全部":"".concat(t,"表单 ").concat(a,"部门")}},{key:"status",title:"状态",type:"tag",width:200,data:[{value:"active",label:"启用",tagType:"success"},{value:"inactive",label:"停用",tagType:"danger"}]},{key:"update_date",title:"更新时间",type:"time",width:200}],multipleSelection:[],selectItem:""},queryForm1:{formData:{code:"",name:"",status:""},columns:[{key:"code",title:"规则编码",type:"text",width:200,mode:"%%"},{key:"name",title:"规则名称",type:"text",width:200,mode:"%%"},{key:"status",title:"状态",type:"select",width:200,mode:"=",data:[{value:"active",label:"启用"},{value:"inactive",label:"停用"}]}]},form1:{data:{code:"",name:"",description:"",rule_expression:{type:"simple",conditions:[],logic:"and"},scope:{form_types:[],departments:[]},status:"active"},props:{action:"",rules:{code:[{required:!0,message:"规则编码不能为空",trigger:["blur","change"]},{max:50,message:"规则编码长度不能超过50个字符",trigger:["blur","change"]},{pattern:/^[A-Z][A-Z0-9_]*$/,message:"规则编码只能包含大写字母、数字和下划线，且以字母开头",trigger:["blur","change"]}],name:[{required:!0,message:"规则名称不能为空",trigger:["blur","change"]},{max:100,message:"规则名称长度不能超过100个字符",trigger:["blur","change"]}],"rule_expression.conditions":[{validator:function(e,t,a){if(t&&0!==t.length){var o=t.some((function(e){return!e.field||!e.operator||void 0===e.value||null===e.value||""===e.value}));o?a(new Error("请完善所有条件配置")):a()}else a(new Error("至少需要配置一个条件"))},trigger:["blur","change"]}],status:[{required:!0,message:"状态不能为空",trigger:["blur","change"]}]},formType:"",title:"",show:!1}}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s=this.vk,this.options=e,this.init(e)},methods:{init:function(e){var t=this;return(0,r.default)((0,l.default)().mark((function e(){return(0,l.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return d["form1"]=s.pubfn.copyObject(t.form1),e.next=3,t.loadFormTypes();case 3:return e.next=5,t.loadDepartments();case 5:t.addCondition();case 6:case"end":return e.stop()}}),e)})))()},loadFormTypes:function(){var e=this;return(0,r.default)((0,l.default)().mark((function t(){var a;return(0,l.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.vk.callFunction({url:"admin/bpmn/form-type/sys/getList",data:{formData:{status:"active"}}});case 3:a=t.sent,0===a.code&&(e.formTypes=a.rows.map((function(e){return{value:e.code,label:e.name}}))),t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("加载表单类型失败:",t.t0),e.formTypes=[{value:"SEAL_APPLY",label:"用印申请"},{value:"LEAVE_APPLY",label:"请假申请"},{value:"EXPENSE_APPLY",label:"费用报销"}];case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},loadDepartments:function(){var e=this;return(0,r.default)((0,l.default)().mark((function t(){return(0,l.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{e.departments=[{value:"tech",label:"技术部"},{value:"sales",label:"销售部"},{value:"marketing",label:"市场部"},{value:"hr",label:"人力资源部"},{value:"finance",label:"财务部"}]}catch(a){console.error("加载部门数据失败:",a)}case 1:case"end":return t.stop()}}),t)})))()},addCondition:function(){this.form1.data.rule_expression.conditions.push({field:"",operator:"eq",value:"",value_type:"constant"})},addConditionGroup:function(){this.form1.data.rule_expression.conditions.push({field:"",operator:"eq",value:"",value_type:"constant",_group:!0})},removeCondition:function(e){this.form1.data.rule_expression.conditions.length>1?this.form1.data.rule_expression.conditions.splice(e,1):this.$message.warning("至少需要保留一个条件")},onFieldChange:function(e){var t=this.getFieldConfig(e.field);if(t){var a=this.getAvailableOperators(e.field)[0];e.operator=a?a.value:"eq",e.value=""}},onValueTypeChange:function(e){e.value=""},onRuleTypeChange:function(e){"simple"===e&&this.form1.data.rule_expression.conditions.length>1&&this.$message.info("简单规则模式下，建议只使用一个条件")},getFieldConfig:function(e){var t,a=(0,i.default)(this.fieldGroups);try{for(a.s();!(t=a.n()).done;){var o=t.value,n=o.options.find((function(t){return t.value===e}));if(n)return n}}catch(l){a.e(l)}finally{a.f()}return null},getAvailableOperators:function(e){var t=this.getFieldConfig(e);return t&&this.operators[t.type]||this.operators.string},getValueComponent:function(e){var t=this.getFieldConfig(e.field);return t&&"select"===t.type?"ValueInput":"el-input"},isMultipleOperator:function(e){return["in","not_in"].includes(e)},getFieldOptions:function(e){return this.fieldOptions[e]||[]},getValuePlaceholder:function(e){var t=this.getFieldConfig(e.field);if(!t)return"输入值";switch(e.value_type){case"variable":return"输入变量名，如：${applicant.department}";case"expression":return"输入表达式，如：amount > 1000";default:return"select"===t.type?"选择值":"输入值"}},getValueTypeDescription:function(e){return{constant:"固定值，直接参与条件比较",variable:"引用流程变量，运行时动态获取值",expression:"JavaScript表达式，支持复杂逻辑计算"}[e]||""},formatRulePreview:function(){var e=this,t=this.form1.data.rule_expression,a=t.conditions,o=t.type,n=t.logic;if(0===a.length)return"暂无条件";var i=a.map((function(t){var a,o=e.getFieldConfig(t.field),n=o?o.label:t.field,i=(null===(a=e.operators.string.find((function(e){return e.value===t.operator})))||void 0===a?void 0:a.label)||t.operator;return"".concat(n," ").concat(i," ").concat(t.value)}));if("simple"===o||1===a.length)return i[0];var l="and"===n?" 并且 ":" 或者 ";return i.join(l)},testCondition:function(e){this.$message.info("测试条件: ".concat(this.formatConditionText(e)))},testRule:function(e){this.$message.info("测试规则: ".concat(e.name))},showRuleHelp:function(){this.ruleHelpVisible=!0},formatConditionText:function(e){var t,a=this.getFieldConfig(e.field),o=a?a.label:e.field,n=(null===(t=this.operators.string.find((function(t){return t.value===e.operator})))||void 0===t?void 0:t.label)||e.operator;return"".concat(o," ").concat(n," ").concat(e.value)},resetForm:function(){this.form1.data=s.pubfn.copyObject(d["form1"].data),this.enableScope=!0,this.addCondition(),this.$refs.formRef&&this.$refs.formRef.clearValidate()},search:function(){this.$refs.table1.search()},refresh:function(){this.$refs.table1.refresh()},getCurrentRow:function(){return this.$refs.table1.getCurrentRow()},currentChange:function(e){this.table1.selectItem=e},selectionChange:function(e){this.table1.multipleSelection=e},addBtn:function(){this.resetForm(),this.form1.props.action="admin/bpmn/condition-rule/sys/add",this.form1.props.formType="add",this.form1.props.title="添加条件规则",this.form1.props.show=!0},updateBtn:function(e){var t=e.item;this.form1.props.action="admin/bpmn/condition-rule/sys/update",this.form1.props.formType="update",this.form1.props.title="编辑条件规则",this.form1.props.show=!0,this.form1.data=s.pubfn.copyObject(t),this.form1.data.rule_expression||(this.form1.data.rule_expression={type:"simple",conditions:[],logic:"and"}),this.form1.data.scope||(this.form1.data.scope={form_types:[],departments:[]}),this.enableScope=this.form1.data.scope.form_types.length>0||this.form1.data.scope.departments.length>0},showDetail:function(e){this.$message.info("查看规则详情: ".concat(e.name))},deleteBtn:function(e){var t=this,a=e.item;this.$confirm("确定删除该条件规则吗？","提示",{type:"warning"}).then((0,r.default)((0,l.default)().mark((function e(){var o;return(0,l.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.vk.callFunction({url:"admin/bpmn/condition-rule/sys/delete",data:{_id:a._id}});case 3:o=e.sent,0===o.code?(t.$message.success("删除成功"),t.refresh()):t.$message.error(o.msg||"删除失败"),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("删除失败:",e.t0),t.$message.error("删除失败");case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).catch((function(){}))},submitForm:function(){var e=this;return(0,r.default)((0,l.default)().mark((function t(){var a;return(0,l.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$refs.formRef){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e.$refs.formRef.validate();case 5:return e.enableScope||(e.form1.data.scope.form_types=[],e.form1.data.scope.departments=[]),e.formLoading=!0,t.next=9,e.vk.callFunction({url:e.form1.props.action,data:(0,n.default)((0,n.default)({},e.form1.data),{},{_id:e.form1.data._id})});case 9:a=t.sent,0===a.code?(e.$message.success("add"===e.form1.props.formType?"添加成功":"更新成功"),e.form1.props.show=!1,e.refresh()):e.$message.error(a.msg||"操作失败"),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](2),console.error("表单验证失败:",t.t0);case 16:return t.prev=16,e.formLoading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[2,13,16,19]])})))()},saveAndTest:function(){var e=this;return(0,r.default)((0,l.default)().mark((function t(){return(0,l.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.submitForm();case 2:e.form1.props.show||e.testRule(e.form1.data);case 3:case"end":return t.stop()}}),t)})))()}}};t.default=c},"811b":function(e,t,a){"use strict";a.r(t);var o=a("db32"),n=a("091c");for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);a("acdd");var l=a("828b"),r=Object(l["a"])(n["default"],o["b"],o["c"],!1,null,"d0fa1802",null,!1,o["a"],void 0);t["default"]=r.exports},acdd:function(e,t,a){"use strict";var o=a("ef74"),n=a.n(o);n.a},db32:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"page-body"},[a("vk-data-table-query",{attrs:{columns:e.queryForm1.columns},on:{search:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}},model:{value:e.queryForm1.formData,callback:function(t){e.$set(e.queryForm1,"formData",t)},expression:"queryForm1.formData"}}),a("v-uni-view",{staticClass:"button-group"},[a("el-row",[e.$hasRole("admin")||e.$hasPermission("bpmn-workflow-add")?a("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addBtn.apply(void 0,arguments)}}},[e._v(" 添加条件规则 ")]):e._e(),a("el-button",{attrs:{type:"warning",size:"small",icon:"el-icon-refresh"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.refresh.apply(void 0,arguments)}}},[e._v(" 刷新 ")])],1)],1),a("vk-data-table",{ref:"table1",attrs:{action:e.table1.action,columns:e.table1.columns,"query-form-param":e.queryForm1,"right-btns":e.table1.rightBtns,selection:!0,"row-no":!1,pagination:!0},on:{update:function(t){arguments[0]=t=e.$handleEvent(t),e.updateBtn.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deleteBtn.apply(void 0,arguments)},"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.currentChange.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}}),a("vk-data-dialog",{attrs:{title:e.form1.props.title,width:"1000px",mode:"form","close-on-click-modal":!1,"custom-class":"condition-rule-dialog"},scopedSlots:e._u([{key:"footer",fn:function(){return[a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"medium"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.form1.props.show=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.formLoading,size:"medium"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitForm.apply(void 0,arguments)}}},[e._v(" "+e._s("add"===e.form1.props.formType?"创建规则":"更新规则")+" ")]),a("el-button",{attrs:{type:"success",loading:e.formLoading,size:"medium"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.saveAndTest.apply(void 0,arguments)}}},[e._v(" 保存并测试 ")])],1)]},proxy:!0}]),model:{value:e.form1.props.show,callback:function(t){e.$set(e.form1.props,"show",t)},expression:"form1.props.show"}},[a("div",{staticClass:"dialog-content"},[a("el-form",{ref:"formRef",staticClass:"condition-form",attrs:{model:e.form1.data,rules:e.form1.props.rules,"label-width":"130px"}},[a("el-card",{staticClass:"form-section",attrs:{shadow:"never"}},[a("div",{staticClass:"section-header",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"section-title"},[e._v("基础信息")])]),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"规则编码",prop:"code"}},[a("el-input",{attrs:{placeholder:"请输入规则编码，如：RULE_SEAL_URGENT",maxlength:"50","show-word-limit":!0},model:{value:e.form1.data.code,callback:function(t){e.$set(e.form1.data,"code",t)},expression:"form1.data.code"}},[a("template",{slot:"prepend"},[e._v("RULE_")])],2),a("div",{staticClass:"form-tip"},[e._v("规则编码需唯一，建议使用大写英文和下划线")])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"规则名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入规则名称",maxlength:"100","show-word-limit":!0},model:{value:e.form1.data.name,callback:function(t){e.$set(e.form1.data,"name",t)},expression:"form1.data.name"}})],1)],1)],1),a("el-form-item",{attrs:{label:"规则描述"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入规则描述",rows:2,maxlength:"500","show-word-limit":!0},model:{value:e.form1.data.description,callback:function(t){e.$set(e.form1.data,"description",t)},expression:"form1.data.description"}})],1)],1),a("el-card",{staticClass:"form-section",attrs:{shadow:"never"}},[a("div",{staticClass:"section-header",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"section-title"},[e._v("条件配置")]),a("div",{staticClass:"section-actions"},[a("el-radio-group",{attrs:{size:"small"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.onRuleTypeChange.apply(void 0,arguments)}},model:{value:e.form1.data.rule_expression.type,callback:function(t){e.$set(e.form1.data.rule_expression,"type",t)},expression:"form1.data.rule_expression.type"}},[a("el-radio-button",{attrs:{label:"simple"}},[e._v("简单规则")]),a("el-radio-button",{attrs:{label:"composite"}},[e._v("复合规则")])],1),"composite"===e.form1.data.rule_expression.type?a("el-radio-group",{staticStyle:{"margin-left":"12px"},attrs:{size:"small"},model:{value:e.form1.data.rule_expression.logic,callback:function(t){e.$set(e.form1.data.rule_expression,"logic",t)},expression:"form1.data.rule_expression.logic"}},[a("el-radio-button",{attrs:{label:"and"}},[e._v("并且 (AND)")]),a("el-radio-button",{attrs:{label:"or"}},[e._v("或者 (OR)")])],1):e._e(),a("el-button",{staticStyle:{"margin-left":"12px"},attrs:{type:"text",icon:"el-icon-question",size:"small"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showRuleHelp.apply(void 0,arguments)}}},[e._v(" 规则说明 ")])],1)]),e.form1.data.rule_expression.conditions.length>0?a("div",{staticClass:"rule-preview"},[a("div",{staticClass:"preview-title"},[e._v("条件预览：")]),a("div",{staticClass:"preview-content"},[e._v(" "+e._s(e.formatRulePreview())+" ")])]):e._e(),a("el-form-item",{staticClass:"no-margin-form-item",attrs:{prop:"rule_expression.conditions"}},[a("div",{staticClass:"conditions-container"},[a("div",{staticClass:"condition-list"},e._l(e.form1.data.rule_expression.conditions,(function(t,o){return a("div",{key:o,staticClass:"condition-item"},[a("div",{staticClass:"condition-header"},[a("span",{staticClass:"condition-index"},[e._v("条件 "+e._s(o+1))]),e.form1.data.rule_expression.conditions.length>1?a("el-button",{staticClass:"condition-remove-btn",attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.removeCondition(o)}}},[e._v(" 删除 ")]):e._e()],1),a("div",{staticClass:"condition-content"},[a("el-row",{staticClass:"condition-row",attrs:{gutter:12}},[a("el-col",{attrs:{span:5}},[a("el-form-item",{staticClass:"inline-form-item",attrs:{prop:"rule_expression.conditions["+o+"].field",rules:e.fieldRules}},[a("el-select",{attrs:{placeholder:"选择字段",size:"small",filterable:!0},on:{change:function(a){arguments[0]=a=e.$handleEvent(a),e.onFieldChange(t)}},model:{value:t.field,callback:function(a){e.$set(t,"field",a)},expression:"condition.field"}},e._l(e.fieldGroups,(function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[a("div",{staticClass:"field-option"},[a("div",{staticClass:"field-name"},[e._v(e._s(t.label))]),a("div",{staticClass:"field-desc"},[e._v(e._s(t.description))])])])})),1)})),1)],1)],1),a("el-col",{attrs:{span:4}},[a("el-form-item",{staticClass:"inline-form-item",attrs:{prop:"rule_expression.conditions["+o+"].operator",rules:e.operatorRules}},[a("el-select",{attrs:{placeholder:"操作符",size:"small"},model:{value:t.operator,callback:function(a){e.$set(t,"operator",a)},expression:"condition.operator"}},e._l(e.getAvailableOperators(t.field),(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)],1)],1),a("el-col",{attrs:{span:10}},[a("el-form-item",{staticClass:"inline-form-item",attrs:{prop:"rule_expression.conditions["+o+"].value",rules:e.valueRules}},[a(e.getValueComponent(t),{tag:"component",staticStyle:{width:"100%"},attrs:{placeholder:e.getValuePlaceholder(t),options:e.getFieldOptions(t.field),multiple:e.isMultipleOperator(t.operator),size:"small"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"condition.value"}})],1)],1),a("el-col",{attrs:{span:3}},[a("el-form-item",{staticClass:"inline-form-item",attrs:{prop:"rule_expression.conditions["+o+"].value_type",rules:e.valueTypeRules}},[a("el-select",{attrs:{placeholder:"值类型",size:"small"},on:{change:function(a){arguments[0]=a=e.$handleEvent(a),e.onValueTypeChange(t)}},model:{value:t.value_type,callback:function(a){e.$set(t,"value_type",a)},expression:"condition.value_type"}},e._l(e.valueTypes,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{staticClass:"condition-actions",attrs:{span:2}},[a("el-tooltip",{attrs:{content:"测试条件",placement:"top"}},[a("el-button",{attrs:{type:"info",icon:"el-icon-view",circle:!0,size:"mini"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.testCondition(t)}}})],1)],1)],1),t.value_type?a("div",{staticClass:"value-type-tip"},[e._v(" 值类型："+e._s(e.getValueTypeDescription(t.value_type))+" ")]):e._e()],1),"composite"===e.form1.data.rule_expression.type&&o<e.form1.data.rule_expression.conditions.length-1?a("div",{staticClass:"condition-connector"},[a("div",{staticClass:"connector-line"}),a("div",{staticClass:"connector-text"},[a("el-tag",{attrs:{size:"small",type:"and"===e.form1.data.rule_expression.logic?"success":"warning"}},[e._v(" "+e._s("and"===e.form1.data.rule_expression.logic?"并且 (AND)":"或者 (OR)")+" ")])],1),a("div",{staticClass:"connector-line"})]):e._e()])})),0),a("div",{staticClass:"condition-actions-bottom"},[a("el-button",{staticClass:"add-condition-btn",attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addCondition.apply(void 0,arguments)}}},[e._v(" 添加条件 ")]),"composite"===e.form1.data.rule_expression.type?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addConditionGroup.apply(void 0,arguments)}}},[e._v(" 添加条件组 ")]):e._e()],1)])])],1),a("el-card",{staticClass:"form-section",attrs:{shadow:"never"}},[a("div",{staticClass:"section-header",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"section-title"},[e._v("适用范围")]),a("el-switch",{attrs:{"active-text":"启用范围限制","inactive-text":"禁用范围限制"},model:{value:e.enableScope,callback:function(t){e.enableScope=t},expression:"enableScope"}})],1),e.enableScope?a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"适用表单类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:!0,placeholder:"请选择适用的表单类型",filterable:!0,clearable:!0},model:{value:e.form1.data.scope.form_types,callback:function(t){e.$set(e.form1.data.scope,"form_types",t)},expression:"form1.data.scope.form_types"}},e._l(e.formTypes,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[a("div",{staticClass:"option-item"},[a("div",{staticClass:"option-name"},[e._v(e._s(t.label))]),a("div",{staticClass:"option-code"},[e._v(e._s(t.value))])])])})),1),a("div",{staticClass:"form-tip"},[e._v("不选择表示适用于所有表单类型")])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"适用部门"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:!0,placeholder:"请选择适用的部门",filterable:!0,clearable:!0},model:{value:e.form1.data.scope.departments,callback:function(t){e.$set(e.form1.data.scope,"departments",t)},expression:"form1.data.scope.departments"}},e._l(e.departments,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("div",{staticClass:"form-tip"},[e._v("不选择表示适用于所有部门")])],1)],1)],1):a("div",{staticClass:"scope-disabled-tip"},[a("el-alert",{attrs:{title:"适用范围限制已禁用，此规则将适用于所有表单和部门",type:"info",closable:!1,"show-icon":!0}})],1)],1),a("el-card",{staticClass:"form-section",attrs:{shadow:"never"}},[a("div",{staticClass:"section-header",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"section-title"},[e._v("状态设置")])]),a("el-form-item",{attrs:{label:"规则状态",prop:"status"}},[a("el-radio-group",{model:{value:e.form1.data.status,callback:function(t){e.$set(e.form1.data,"status",t)},expression:"form1.data.status"}},[a("el-radio",{attrs:{label:"active",border:!0}},[e._v("启用")]),a("el-radio",{attrs:{label:"inactive",border:!0}},[e._v("停用")])],1),a("div",{staticClass:"form-tip"},[e._v("停用的规则不会在流程路由中使用")])],1)],1)],1)],1)]),a("el-dialog",{attrs:{title:"条件规则说明",visible:e.ruleHelpVisible,width:"600px"},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.ruleHelpVisible=t}}},[a("div",{staticClass:"rule-help-content"},[a("h3",[e._v("条件规则配置指南")]),a("el-divider"),a("h4",[e._v("1. 规则类型")]),a("ul",[a("li",[a("strong",[e._v("简单规则")]),e._v("：单个条件或多个条件的组合")]),a("li",[a("strong",[e._v("复合规则")]),e._v("：支持 AND/OR 逻辑组合的复杂条件")])]),a("h4",[e._v("2. 值类型说明")]),a("ul",[a("li",[a("strong",[e._v("常量")]),e._v('：固定的值，如："紧急"、100')]),a("li",[a("strong",[e._v("变量")]),e._v("：引用流程变量，如：${applicant.department}")]),a("li",[a("strong",[e._v("表达式")]),e._v("：JavaScript表达式，如：amount > 1000")])]),a("h4",[e._v("3. 操作符说明")]),a("el-table",{attrs:{data:e.operatorHelpData,size:"small",border:!0}},[a("el-table-column",{attrs:{prop:"operator",label:"操作符",width:"100"}}),a("el-table-column",{attrs:{prop:"description",label:"说明"}}),a("el-table-column",{attrs:{prop:"example",label:"示例",width:"200"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.ruleHelpVisible=!1}}},[e._v("关闭")])],1)])],1)},n=[]},ef74:function(e,t,a){var o=a("284d");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var n=a("967d").default;n("47ddf06d",o,!0,{sourceMap:!1,shadowMode:!1})}}]);